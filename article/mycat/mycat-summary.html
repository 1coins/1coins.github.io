<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.66" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://1coins.github.io/article/mycat/mycat-summary.html"><meta property="og:site_name" content="ä¹¾å…ƒ"><meta property="og:title" content="MyCat æ€»ç»“"><meta property="og:description" content="MyCat æ¦‚è¿° MyCat æ˜¯ä»€ä¹ˆ å®˜ç½‘ã€‚ MyCat æ˜¯æ•°æ®åº“ä¸­é—´ä»¶ã€‚ æ•°æ®åº“ä¸­é—´ä»¶ ä¸­é—´ä»¶ï¼šæ˜¯ä¸€ç±»è¿æ¥è½¯ä»¶ç»„ä»¶å’Œåº”ç”¨çš„è®¡ç®—æœºè½¯ä»¶ï¼Œä»¥ä¾¿äºè½¯ä»¶å„éƒ¨ä»¶ä¹‹é—´çš„æ²Ÿé€šã€‚ä¾‹å¦‚Tomcatæ˜¯Webä¸­é—´ä»¶ã€‚ æ•°æ®åº“ä¸­é—´ä»¶ï¼šè¿æ¥Javaåº”ç”¨ç¨‹åºå’Œæ•°æ®åº“ã€‚ ä¸ºä»€ä¹ˆè¦ç”¨ MyCat"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-08-27T07:08:54.000Z"><meta property="article:author" content="ä¹¾å…ƒ"><meta property="article:tag" content="MyCat"><meta property="article:published_time" content="2023-09-06T00:00:00.000Z"><meta property="article:modified_time" content="2023-08-27T07:08:54.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"MyCat æ€»ç»“","image":[""],"datePublished":"2023-09-06T00:00:00.000Z","dateModified":"2023-08-27T07:08:54.000Z","author":[{"@type":"Person","name":"ä¹¾å…ƒ","url":"https://github.com/1coins","email":"lau5464@126.com"}]}</script><meta name="robots" content="all"><meta name="author" content="ä¹¾å…ƒ"><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><meta name="keywords" content="JavaåŸºç¡€, å¤šçº¿ç¨‹, JVM, è™šæ‹Ÿæœº, æ•°æ®åº“, MySQL, Spring, Redis, MyBatis, ç³»ç»Ÿè®¾è®¡, åˆ†å¸ƒå¼, RPC, é«˜å¯ç”¨, é«˜å¹¶å‘"><meta name="apple-mobile-web-app-capable" content="yes"><script>var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?5dd2e8c97962d57b7b8fea1737c01743";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();</script><link rel="icon" href="/favicon.png"><link rel="icon" href="/pwa/512.png" type="image/png" sizes="512x512"><link rel="icon" href="/pwa/192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/pwa/144.png"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/pwa/144.png"><meta name="msapplication-TileColor" content="#000"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><link rel="alternate" type="application/json" href="https://1coins.github.io/feed.json" title="ä¹¾å…ƒ JSON Feed"><title>MyCat æ€»ç»“ | ä¹¾å…ƒ</title><meta name="description" content="MyCat æ¦‚è¿° MyCat æ˜¯ä»€ä¹ˆ å®˜ç½‘ã€‚ MyCat æ˜¯æ•°æ®åº“ä¸­é—´ä»¶ã€‚ æ•°æ®åº“ä¸­é—´ä»¶ ä¸­é—´ä»¶ï¼šæ˜¯ä¸€ç±»è¿æ¥è½¯ä»¶ç»„ä»¶å’Œåº”ç”¨çš„è®¡ç®—æœºè½¯ä»¶ï¼Œä»¥ä¾¿äºè½¯ä»¶å„éƒ¨ä»¶ä¹‹é—´çš„æ²Ÿé€šã€‚ä¾‹å¦‚Tomcatæ˜¯Webä¸­é—´ä»¶ã€‚ æ•°æ®åº“ä¸­é—´ä»¶ï¼šè¿æ¥Javaåº”ç”¨ç¨‹åºå’Œæ•°æ®åº“ã€‚ ä¸ºä»€ä¹ˆè¦ç”¨ MyCat">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-aca62eb1.css" as="style"><link rel="stylesheet" href="/assets/style-aca62eb1.css">
    <link rel="modulepreload" href="/assets/app-3e6d2d9d.js"><link rel="modulepreload" href="/assets/mycat-summary.html-d34bf8f4.js"><link rel="modulepreload" href="/assets/mycat-summary.html-fb1c2e17.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container no-sidebar has-toc"><!--[--><header id="navbar" class="vp-navbar auto-hide"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand" href="/"><img class="vp-nav-logo" src="/pwa/144.png" alt="ä¹¾å…ƒ"><!----><span class="vp-site-name hide-in-pad">ä¹¾å…ƒ</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!--[--><button type="button" class="search-pro-button" role="search" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="vp-link nav-link" href="/"><span class="font-icon icon iconfont icon-home" style=""></span>é¦–é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="ç´¢å¼•"><span class="title"><span class="font-icon icon iconfont icon-jiansuo" style=""></span>ç´¢å¼•</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link active" href="/article.html"><span class="font-icon icon iconfont icon-list" style=""></span>å…¨éƒ¨<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/category.html"><span class="font-icon icon iconfont icon-category" style=""></span>åˆ†ç±»<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/tag.html"><span class="font-icon icon iconfont icon-tag" style=""></span>æ ‡ç­¾<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/timeline.html"><span class="font-icon icon iconfont icon-time" style=""></span>æ—¶é—´è½´<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="æ”¶è—"><span class="title"><span class="font-icon icon iconfont icon-favoritea" style=""></span>æ”¶è—</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/favorite/links.html"><span class="font-icon icon iconfont icon-link" style=""></span>é“¾æ¥<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/favorite/movies.html"><span class="font-icon icon iconfont icon-movie" style=""></span>å½±è§†<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/favorite/music.html"><span class="font-icon icon iconfont icon-music" style=""></span>éŸ³ä¹<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/favorite/photos.html"><span class="font-icon icon iconfont icon-xiangce" style=""></span>ç›¸å†Œ<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a class="vp-link nav-link" href="/about.html"><span class="font-icon icon iconfont icon-info" style=""></span>å…³äº<!----></a></div></nav><!----><div class="nav-item hide-in-mobile"><button type="button" class="outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->MyCat æ€»ç»“</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/1coins" target="_blank" rel="noopener noreferrer">ä¹¾å…ƒ</a></span><span property="author" content="ä¹¾å…ƒ"></span></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item category4 clickable" role="navigation">MyCat</span><!--]--><meta property="articleSection" content="MyCat"></span><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-09-06T00:00:00.000Z"></span><!----><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag4 clickable" role="navigation">MyCat</span><!--]--><meta property="keywords" content="MyCat"></span><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 37 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT37M"></span><span class="page-word-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 10999 å­—</span><meta property="wordCount" content="10999"></span><span class="page-pageview-info" aria-label="è®¿é—®é‡ğŸ”¢" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon eye-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="eye icon"><path d="M992 512.096c0-5.76-.992-10.592-1.28-11.136-.192-2.88-1.152-8.064-2.08-10.816-.256-.672-.544-1.376-.832-2.08-.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160c-195.072 0-385.632 130.016-473.76 322.592-1.056 2.112-1.792 4.096-2.272 5.856a55.512 55.512 0 00-.64 1.6c-1.76 5.088-1.792 8.64-1.632 7.744-.832 3.744-1.568 11.168-1.568 11.168-.224 2.272-.224 4.032.032 6.304 0 0 .736 6.464 1.088 7.808.128 1.824.576 4.512 1.12 6.976h-.032c.448 2.08 1.12 4.096 1.984 6.08.48 1.536.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512 864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912.256-.608.48-1.184.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32l-.032.032c.608-3.104 1.568-7.744 1.568-13.28zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160 160-71.776 160-160 160z"></path></svg><span id="ArtalkPV" class="waline-pageview-count" data-path="/article/mycat/mycat-summary.html">...</span></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#mycat-æ˜¯ä»€ä¹ˆ">MyCat æ˜¯ä»€ä¹ˆ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æ•°æ®åº“ä¸­é—´ä»¶">æ•°æ®åº“ä¸­é—´ä»¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ä¸ºä»€ä¹ˆè¦ç”¨-mycat">ä¸ºä»€ä¹ˆè¦ç”¨ MyCat</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æ•°æ®åº“ä¸­é—´ä»¶å¯¹æ¯”">æ•°æ®åº“ä¸­é—´ä»¶å¯¹æ¯”</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#mycat-èƒ½åšä»€ä¹ˆ">MyCat èƒ½åšä»€ä¹ˆ</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#è¯»å†™åˆ†ç¦»">è¯»å†™åˆ†ç¦»</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æ•°æ®åˆ†ç‰‡">æ•°æ®åˆ†ç‰‡</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å¤šæ•°æ®æºæ•´åˆ">å¤šæ•°æ®æºæ•´åˆ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#å®‰è£…">å®‰è£…</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#å¯åŠ¨">å¯åŠ¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#ç™»å½•">ç™»å½•</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#è¯»å†™åˆ†ç¦»-1">è¯»å†™åˆ†ç¦»</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ä¸€ä¸»ä¸€ä»">ä¸€ä¸»ä¸€ä»</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#åŒä¸»åŒä»">åŒä¸»åŒä»</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#å‚ç›´æ‹†åˆ†â€”â€”åˆ†åº“">å‚ç›´æ‹†åˆ†â€”â€”åˆ†åº“</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å¦‚ä½•åˆ’åˆ†è¡¨">å¦‚ä½•åˆ’åˆ†è¡¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å®ç°åˆ†åº“">å®ç°åˆ†åº“</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#æ°´å¹³æ‹†åˆ†â€”â€”åˆ†è¡¨">æ°´å¹³æ‹†åˆ†â€”â€”åˆ†è¡¨</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å®ç°åˆ†è¡¨">å®ç°åˆ†è¡¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#mycat-åˆ†ç‰‡åçš„-join-æŸ¥è¯¢">Mycat åˆ†ç‰‡åçš„ join æŸ¥è¯¢</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å¸¸ç”¨åˆ†ç‰‡è§„åˆ™">å¸¸ç”¨åˆ†ç‰‡è§„åˆ™</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å…¨å±€åºåˆ—">å…¨å±€åºåˆ—</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#åŸºäº-ha-æœºåˆ¶çš„-mycat-é«˜å¯ç”¨">åŸºäº HA æœºåˆ¶çš„ MyCat é«˜å¯ç”¨</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#é«˜å¯ç”¨æ–¹æ¡ˆ">é«˜å¯ç”¨æ–¹æ¡ˆ</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#å®‰è£…é…ç½®-haproxy">å®‰è£…é…ç½® HAProxy</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#é…ç½®-keepalived">é…ç½® Keepalived</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#æµ‹è¯•é«˜å¯ç”¨">æµ‹è¯•é«˜å¯ç”¨</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#æƒé™é…ç½®">æƒé™é…ç½®</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#user-æ ‡ç­¾æƒé™æ§åˆ¶">user æ ‡ç­¾æƒé™æ§åˆ¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#privileges-æ ‡ç­¾æƒé™æ§åˆ¶">privileges æ ‡ç­¾æƒé™æ§åˆ¶</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#sql-æ‹¦æˆª">SQL æ‹¦æˆª</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ç™½åå•">ç™½åå•</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#é»‘åå•">é»‘åå•</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#mycat-web-ç®€ä»‹">MyCat-Web ç®€ä»‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#mycat-web-é…ç½®ä½¿ç”¨">MyCat-Web é…ç½®ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#mycat-æ€§èƒ½ç›‘æ§æŒ‡æ ‡">Mycat æ€§èƒ½ç›‘æ§æŒ‡æ ‡</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h1 id="mycat-æ¦‚è¿°" tabindex="-1"><a class="header-anchor" href="#mycat-æ¦‚è¿°" aria-hidden="true">#</a> MyCat æ¦‚è¿°</h1><h2 id="mycat-æ˜¯ä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#mycat-æ˜¯ä»€ä¹ˆ" aria-hidden="true">#</a> MyCat æ˜¯ä»€ä¹ˆ</h2><p><a href="http://www.mycat.io/" target="_blank" rel="noopener noreferrer">å®˜ç½‘<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚</p><p>MyCat æ˜¯æ•°æ®åº“ä¸­é—´ä»¶ã€‚</p><h3 id="æ•°æ®åº“ä¸­é—´ä»¶" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åº“ä¸­é—´ä»¶" aria-hidden="true">#</a> æ•°æ®åº“ä¸­é—´ä»¶</h3><p>ä¸­é—´ä»¶ï¼šæ˜¯ä¸€ç±»è¿æ¥è½¯ä»¶ç»„ä»¶å’Œåº”ç”¨çš„è®¡ç®—æœºè½¯ä»¶ï¼Œä»¥ä¾¿äºè½¯ä»¶å„éƒ¨ä»¶ä¹‹é—´çš„æ²Ÿé€šã€‚ä¾‹å¦‚<code>Tomcat</code>æ˜¯<code>Web</code>ä¸­é—´ä»¶ã€‚<br> æ•°æ®åº“ä¸­é—´ä»¶ï¼šè¿æ¥<code>Java</code>åº”ç”¨ç¨‹åºå’Œæ•°æ®åº“ã€‚</p><h3 id="ä¸ºä»€ä¹ˆè¦ç”¨-mycat" tabindex="-1"><a class="header-anchor" href="#ä¸ºä»€ä¹ˆè¦ç”¨-mycat" aria-hidden="true">#</a> ä¸ºä»€ä¹ˆè¦ç”¨ MyCat</h3><ol><li><code>Java</code>ä¸æ•°æ®åº“ç´§è€¦åˆ</li><li>é«˜è®¿é—®é‡é«˜å¹¶å‘å¯¹æ•°æ®åº“çš„å‹åŠ›</li><li>è¯»å†™è¯·æ±‚æ•°æ®ä¸ä¸€è‡´</li></ol><h3 id="æ•°æ®åº“ä¸­é—´ä»¶å¯¹æ¯”" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åº“ä¸­é—´ä»¶å¯¹æ¯”" aria-hidden="true">#</a> æ•°æ®åº“ä¸­é—´ä»¶å¯¹æ¯”</h3><ul><li><code>Cobar</code>å±äºé˜¿é‡Œ<code>B2B</code>äº‹ä¸šç¾¤ï¼Œå§‹äº 2008 å¹´ï¼Œåœ¨é˜¿é‡Œæœå½¹ 3 å¹´å¤šï¼Œæ¥ç®¡ 3000+ ä¸ª<code>MySql</code>æ•°æ®åº“çš„<code>schema</code>ï¼Œé›†ç¾¤æ—¥å¤„ç†åœ¨çº¿<code>SQL</code>è¯·æ±‚ 50 äº¿æ¬¡ä»¥ä¸Šï¼›ç”±äº<code>Cobar</code>å‘èµ·äººçš„ç¦»èŒï¼Œ<code>Cobar</code>åœæ­¢ç»´æŠ¤</li><li><code>MyCat</code>æ˜¯å¼€æºç¤¾åŒºåœ¨é˜¿é‡Œ<code>Cobar</code>åŸºç¡€ä¸Šè¿›è¡ŒäºŒæ¬¡å¼€å‘ï¼Œè§£å†³äº†<code>Cobar</code>å­˜åœ¨çš„é—®é¢˜ï¼Œå¹¶ä¸”åŠ å…¥äº†è®¸å¤šæ–°çš„åŠŸèƒ½ï¼Œé’å‡ºäºè“è€Œèƒœäºè“</li><li><code>OneProxy</code>åŸºäº<code>MySql</code>å®˜æ–¹çš„<code>Proxy</code>æ€æƒ³åˆ©ç”¨<code>C</code>è¿›è¡Œå¼€å‘çš„ï¼Œ<code>OneProxy</code>æ˜¯ä¸€æ¬¾å•†ä¸šæ”¶è´¹çš„ä¸­é—´ä»¶ï¼Œèˆå¼ƒäº†ä¸€äº›åŠŸèƒ½ï¼Œä¸“æ³¨åœ¨æ€§èƒ½å’Œç¨³å®šæ€§ä¸Š</li><li><code>KingShard</code>ç”±å°å›¢é˜Ÿç”¨<code>Go</code>è¯­è¨€å¼€å‘ï¼Œè¿˜éœ€è¦å‘å±•ï¼Œéœ€è¦ä¸æ–­å®Œå–„</li><li><code>Vitess</code>æ˜¯<code>Youtube</code>ç”Ÿäº§åœ¨ä½¿ç”¨ï¼Œæ¶æ„å¾ˆå¤æ‚ï¼Œä¸æ”¯æŒ<code>MySQL</code>åŸç”Ÿåè®®ï¼Œä½¿ç”¨éœ€è¦å¤§é‡æ”¹é€ æˆæœ¬</li><li><code>Atlas</code>æ˜¯ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>360</mn></mrow><annotation encoding="application/x-tex">360</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">360</span></span></span></span> å›¢é˜ŸåŸºäº<code>MySql Proxy</code>æ”¹å†™ï¼ŒåŠŸèƒ½è¿˜éœ€å®Œå–„ï¼Œé«˜å¹¶å‘ä¸‹ä¸ç¨³å®š</li><li><code>MaxScale</code>æ˜¯<code>MariaDB</code>ï¼ˆ<code>MySq</code>åŸä½œè€…ç»´æŠ¤çš„ä¸€ä¸ªç‰ˆæœ¬ï¼‰ ç ”å‘çš„ä¸­é—´ä»¶</li><li><code>MySqRoute</code>æ˜¯<code>MySql</code>å®˜æ–¹<code>Oracle</code>å…¬å¸å‘å¸ƒçš„ä¸­é—´ä»¶</li></ul><h2 id="mycat-èƒ½åšä»€ä¹ˆ" tabindex="-1"><a class="header-anchor" href="#mycat-èƒ½åšä»€ä¹ˆ" aria-hidden="true">#</a> MyCat èƒ½åšä»€ä¹ˆ</h2><h3 id="è¯»å†™åˆ†ç¦»" tabindex="-1"><a class="header-anchor" href="#è¯»å†™åˆ†ç¦»" aria-hidden="true">#</a> è¯»å†™åˆ†ç¦»</h3><figure><img src="https://cdn.jsdelivr.net/gh/1coins/assets/mycat-summary/read-write-separation.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="æ•°æ®åˆ†ç‰‡" tabindex="-1"><a class="header-anchor" href="#æ•°æ®åˆ†ç‰‡" aria-hidden="true">#</a> æ•°æ®åˆ†ç‰‡</h3><ul><li>å‚ç›´æ‹†åˆ†ï¼ˆåˆ†åº“ï¼‰</li><li>æ°´å¹³æ‹†åˆ†ï¼ˆåˆ†è¡¨ï¼‰</li><li>å‚ç›´+æ°´å¹³æ‹†åˆ†ï¼ˆåˆ†åº“åˆ†è¡¨ï¼‰</li></ul><figure><img src="https://cdn.jsdelivr.net/gh/1coins/assets/mycat-summary/data-fragmentation.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="å¤šæ•°æ®æºæ•´åˆ" tabindex="-1"><a class="header-anchor" href="#å¤šæ•°æ®æºæ•´åˆ" aria-hidden="true">#</a> å¤šæ•°æ®æºæ•´åˆ</h3><p>![](<a href="https://cdn.jsdelivr.net/gh/1coins/assets/mycat-summary/integration-of-multiple-data" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/1coins/assets/mycat-summary/integration-of-multiple-data<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> -sources.png)</p><h1 id="mycat-åŸç†" tabindex="-1"><a class="header-anchor" href="#mycat-åŸç†" aria-hidden="true">#</a> MyCat åŸç†</h1><p><code>MyCAT</code>çš„åŸç†ä¸­æœ€é‡è¦çš„ä¸€ä¸ªåŠ¨è¯æ˜¯â€œæ‹¦æˆªâ€ï¼Œå®ƒæ‹¦æˆªäº†ç”¨æˆ·å‘é€è¿‡æ¥çš„<code>SQL</code>è¯­å¥ï¼Œé¦–å…ˆå¯¹<code>SQL</code><br>è¯­å¥åšäº†ä¸€äº›ç‰¹å®šçš„åˆ†æï¼Œå¦‚åˆ†ç‰‡åˆ†æã€è·¯ç”±åˆ†æã€è¯»å†™åˆ†ç¦»åˆ†æã€ç¼“å­˜åˆ†æç­‰ï¼Œç„¶åå°†æ­¤<code>SQL</code> å‘<br>å¾€åç«¯çš„çœŸå®æ•°æ®åº“ï¼Œå¹¶å°†è¿”å›çš„ç»“æœåšé€‚å½“çš„å¤„ç†ï¼Œæœ€ç»ˆå†è¿”å›ç»™ç”¨æˆ·ã€‚</p><figure><img src="https://cdn.jsdelivr.net/gh/1coins/assets/mycat-summary/mycat-principle.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>è¿™ç§æ–¹å¼æŠŠæ•°æ®åº“çš„åˆ†å¸ƒå¼ä»ä»£ç ä¸­è§£è€¦å‡ºæ¥ï¼Œç¨‹åºå‘˜å¯Ÿè§‰ä¸å‡ºæ¥åå°ä½¿ç”¨<code>MyCat</code>è¿˜æ˜¯<code>MySql</code>ã€‚</p><h1 id="mycat-å®‰è£…å¯åŠ¨" tabindex="-1"><a class="header-anchor" href="#mycat-å®‰è£…å¯åŠ¨" aria-hidden="true">#</a> MyCat å®‰è£…å¯åŠ¨</h1><h2 id="å®‰è£…" tabindex="-1"><a class="header-anchor" href="#å®‰è£…" aria-hidden="true">#</a> å®‰è£…</h2><ol><li>è§£å‹åå³å¯ä½¿ç”¨ <ul><li>è§£å‹ç¼©æ–‡ä»¶æ‹·è´åˆ°<code>linux</code>ä¸‹çš„<code>/usr/local</code>æ–‡ä»¶å¤¹ä¸­</li></ul></li><li>ä¸‰ä¸ªé…ç½®æ–‡ä»¶ <ul><li><code>schema.xml</code>ï¼šå®šä¹‰é€»è¾‘åº“ï¼Œè¡¨ã€åˆ†ç‰‡èŠ‚ç‚¹ç­‰å†…å®¹</li><li><code>rule.xml</code>ï¼šå®šä¹‰åˆ†ç‰‡è§„åˆ™</li><li><code>server.xml</code>ï¼šå®šä¹‰ç”¨æˆ·ä»¥åŠç³»ç»Ÿç›¸å…³å˜é‡ï¼Œå¦‚ç«¯å£ç­‰</li></ul></li></ol><h2 id="å¯åŠ¨" tabindex="-1"><a class="header-anchor" href="#å¯åŠ¨" aria-hidden="true">#</a> å¯åŠ¨</h2><ol><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶<code>server.xml</code><br> ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼Œä¸<code>MySql</code>åŒºåˆ†ï¼Œå¦‚ä¸‹ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mycat<span class="token punctuation">&quot;</span></span> <span class="token attr-name">defaultAccount</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>schemas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>TESTDB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>defaultSchema<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>TESTDB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--No MyCat Database selected é”™è¯¯å‰ä¼šå°è¯•ä½¿ç”¨è¯¥schemaä½œä¸ºschemaï¼Œä¸è®¾ç½®åˆ™ä¸ºnull,æŠ¥é”™ --&gt;</span>

     <span class="token comment">&lt;!-- è¡¨çº§ DML æƒé™è®¾ç½® --&gt;</span>
    <span class="token comment">&lt;!--
    &lt;privileges check=&quot;false&quot;&gt;
        &lt;schema name=&quot;TESTDB&quot; dml=&quot;0110&quot; &gt;
            &lt;table name=&quot;tb01&quot; dml=&quot;0000&quot;&gt;&lt;/table&gt;
            &lt;table name=&quot;tb02&quot; dml=&quot;1111&quot;&gt;&lt;/table&gt;
        &lt;/schema&gt;
    &lt;/privileges&gt;
    --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶<code>schema.xml</code><br> åˆ é™¤æ ‡ç­¾é—´çš„è¡¨ä¿¡æ¯ï¼Œ<code>&lt;dataNode&gt;</code>æ ‡ç­¾åªç•™ä¸€ä¸ªï¼Œ<code>&lt;dataHost&gt;</code>æ ‡ç­¾åªç•™ä¸€ä¸ªï¼Œ<code>&lt;wirteHost&gt;&lt;readHost&gt;</code>åªç•™ä¸€å¯¹</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mycat:schema</span> <span class="token name">SYSTEM</span> <span class="token string">&quot;schema.dtd&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mycat:</span>schema</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>mycat</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://io.mycat/<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schema</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>TESTDB<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checkSQLschema</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sqlMaxLimit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">randomDataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schema</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testdb<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>native<span class="token punctuation">&quot;</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>select user()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!-- can have multi write hosts --&gt;</span>
                <span class="token comment">&lt;!-- ä¸»æ•°æ®åº“ï¼Œç”¨äºå†™ --&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostM1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.30.134:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token comment">&lt;!-- ä»æ•°æ®åº“ï¼Œç”¨äºè¯» --&gt;</span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>readHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostS1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.30.130:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataHost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mycat:</span>schema</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>éªŒè¯æ•°æ®åº“è®¿é—®æƒ…å†µ<br><code>MyCat</code>ä½œä¸ºæ•°æ®åº“ä¸­é—´ä»¶è¦å’Œæ•°æ®åº“éƒ¨ç½²åœ¨ä¸åŒæœºå™¨ä¸Šï¼Œæ‰€ä»¥è¦éªŒè¯è¿œç¨‹è®¿é—®æƒ…å†µã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost conf<span class="token punctuation">]</span><span class="token comment"># mysql -uroot -p123456 -h 192.168.30.134 -P 3306</span>
mysql<span class="token operator">&gt;</span>

<span class="token punctuation">[</span>root@localhost conf<span class="token punctuation">]</span><span class="token comment"># mysql -uroot -p123456 -h 192.168.30.130 -P 3306</span>
mysql<span class="token operator">&gt;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æ— æ³•è®¿é—®ï¼Œåˆ™å…³é—­é˜²ç«å¢™æˆ–å¼€å¯ 3306 ç«¯å£</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># å…³é—­é˜²ç«å¢™</span>
<span class="token punctuation">[</span>root@localhost conf<span class="token punctuation">]</span><span class="token comment"># systemctl stop firewalld.service;</span>

<span class="token comment"># å¯¹å¤–å¼€æ”¾è®¿é—®çš„ç«¯å£</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --add-port=3306/tcp --permanent</span>
<span class="token comment"># é‡å¯é˜²ç«å¢™</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --reload</span>

<span class="token comment"># æŸ¥çœ‹å·²ç»å¼€æ”¾çš„ç«¯å£å·</span>
<span class="token punctuation">[</span>root@localhost home<span class="token punctuation">]</span><span class="token comment"># firewall-cmd --list-all</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å¯åŠ¨ç¨‹åº</p><ul><li>æ§åˆ¶å°å¯åŠ¨ ï¼šå»<code>mycat/bin</code>ç›®å½•ä¸‹æ‰§è¡Œ<code>./mycat console</code><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment">#  ./mycat console</span>
Running Mycat-server<span class="token punctuation">..</span>.
wrapper  <span class="token operator">|</span> --<span class="token operator">&gt;</span> Wrapper Started as Console
wrapper  <span class="token operator">|</span> Launching a JVM<span class="token punctuation">..</span>.
jvm <span class="token number">1</span>    <span class="token operator">|</span> Wrapper <span class="token punctuation">(</span>Version <span class="token number">3.2</span>.3<span class="token punctuation">)</span> http://wrapper.tanukisoftware.org
jvm <span class="token number">1</span>    <span class="token operator">|</span>   Copyright <span class="token number">1999</span>-2006 Tanuki Software, Inc.  All Rights Reserved.
jvm <span class="token number">1</span>    <span class="token operator">|</span>
jvm <span class="token number">1</span>    <span class="token operator">|</span> MyCAT Server startup successfully. see logs <span class="token keyword">in</span> logs/mycat.log
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>åå°å¯åŠ¨ ï¼šå»<code>mycat/bin</code>ç›®å½•ä¸‹<code>./mycat start</code></li></ul><p>ä¸ºäº†èƒ½ç¬¬ä¸€æ—¶é—´çœ‹åˆ°å¯åŠ¨æ—¥å¿—ï¼Œæ–¹ä¾¿å®šä½é—®é¢˜ï¼Œé€‰æ‹©æ§åˆ¶å°å¯åŠ¨ã€‚</p></li><li><p>å¯åŠ¨æ—¶å¯èƒ½å‡ºç°æŠ¥é”™</p><ul><li>å¦‚æœæ— æ³•å¯åŠ¨ï¼Œå¯èƒ½æ²¡æœ‰å®‰è£…<code>JDK</code>ç¯å¢ƒ</li><li>å¦‚æœæ“ä½œç³»ç»Ÿæ˜¯<code>CentOS6.8</code>ï¼Œå¯èƒ½ä¼šå‡ºç°åŸŸåè§£æå¤±è´¥é”™è¯¯ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è§£å†³ <ol><li>ç”¨<code>vi</code>ä¿®æ”¹<code>/etc/hosts</code>æ–‡ä»¶ï¼Œåœ¨ <a href="127.0.0.1">127.0.0.1</a> åé¢å¢åŠ è‡ªå·±çš„æœºå™¨å<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token number">127.0</span>.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain centos02
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>ä¿®æ”¹åé‡æ–°å¯åŠ¨ç½‘ç»œæœåŠ¡<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># service network restart</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol></li></ul></li></ol><h2 id="ç™»å½•" tabindex="-1"><a class="header-anchor" href="#ç™»å½•" aria-hidden="true">#</a> ç™»å½•</h2><ol><li>ç™»å½•åå°ç®¡ç†çª—å£<br> æ­¤ç™»å½•æ–¹å¼ç”¨äºç®¡ç†ç»´æŠ¤<code>MyCat</code><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@centos02 ~<span class="token punctuation">]</span><span class="token comment"># mysql -umycat -p123456 -P 9066 -h 192.168.30.134</span>
mysql: <span class="token punctuation">[</span>Warning<span class="token punctuation">]</span> Using a password on the <span class="token builtin class-name">command</span> line interface can be insecure.
Welcome to the MySQL monitor.  Commands end with <span class="token punctuation">;</span> or <span class="token punctuation">\</span>g.
Your MySQL connection <span class="token function">id</span> is <span class="token number">3</span>
Server version: <span class="token number">5.6</span>.29-mycat-1.6.7.6-release-20211111140317 MyCat Server <span class="token punctuation">(</span>monitor<span class="token punctuation">)</span>

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span>, <span class="token number">2021</span>, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type <span class="token string">&#39;help;&#39;</span> or <span class="token string">&#39;\h&#39;</span> <span class="token keyword">for</span> help. Type <span class="token string">&#39;\c&#39;</span> to <span class="token function">clear</span> the current input statement.

mysql<span class="token operator">&gt;</span> show database<span class="token punctuation">;</span>
+----------+
<span class="token operator">|</span> DATABASE <span class="token operator">|</span>
+----------+
<span class="token operator">|</span> testdb   <span class="token operator">|</span>
+----------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> show @@help<span class="token punctuation">;</span>
+--------------------------------------------------------------+--------------------------------------------+
<span class="token operator">|</span> STATEMENT                                                    <span class="token operator">|</span> DESCRIPTION                                <span class="token operator">|</span>
+--------------------------------------------------------------+--------------------------------------------+
<span class="token operator">|</span> show @@time.current                                          <span class="token operator">|</span> Report current timestamp                   <span class="token operator">|</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
<span class="token number">59</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>ç™»å½•æ•°æ®çª—å£<br> æ­¤ç™»å½•æ–¹å¼ç”¨äºé€šè¿‡<code>MyCat</code>æŸ¥è¯¢æ•°æ®ï¼Œé€‰æ‹©è¿™ç§æ–¹å¼è®¿é—®<code>MyCat</code><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># mysql -umycat -p123456 -P 8066 -h 192.168.30.134</span>
mysql<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h1 id="mycat-å®ä¾‹" tabindex="-1"><a class="header-anchor" href="#mycat-å®ä¾‹" aria-hidden="true">#</a> MyCat å®ä¾‹</h1><h2 id="è¯»å†™åˆ†ç¦»-1" tabindex="-1"><a class="header-anchor" href="#è¯»å†™åˆ†ç¦»-1" aria-hidden="true">#</a> è¯»å†™åˆ†ç¦»</h2><p>é€šè¿‡<code>MyCaT</code>å’Œ<code>MySql</code>çš„ä¸»ä»å¤åˆ¶é…åˆæ­å»ºæ•°æ®åº“çš„è¯»å†™åˆ†ç¦»ï¼Œå®ç°<code>MySql</code>çš„é«˜å¯ç”¨æ€§ã€‚å°†æ­å»ºä¸€ä¸»ä¸€ä»ã€åŒä¸»åŒä»ä¸¤ç§è¯»å†™åˆ†ç¦»æ¨¡å¼ã€‚</p><h3 id="ä¸€ä¸»ä¸€ä»" tabindex="-1"><a class="header-anchor" href="#ä¸€ä¸»ä¸€ä»" aria-hidden="true">#</a> ä¸€ä¸»ä¸€ä»</h3><p>ä¸€ä¸ªä¸»æœºç”¨äºå¤„ç†æ‰€æœ‰å†™è¯·æ±‚ï¼Œä¸€å°ä»æœºè´Ÿè´£æ‰€æœ‰è¯»è¯·æ±‚ï¼Œæ¶æ„å›¾å¦‚ä¸‹ï¼š</p><figure><img src="https://cdn.jsdelivr.net/gh/1coins/assets/mycat-summary/one-master-one-slave.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ol><li><p>æ­å»º<code>MySql</code>æ•°æ®åº“ä¸»ä»å¤åˆ¶</p><ol><li><p><code>MySql</code>ä¸»ä»å¤åˆ¶åŸç†<img src="https://cdn.jsdelivr.net/gh/1coins/assets/mycat-summary/mysql-master-slave-principle.png" alt="" loading="lazy"></p></li><li><p>ä¸»æœºé…ç½®ï¼ˆ<a href="192.168.30.134">192.168.30.134</a>ï¼‰<br> ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š<code>vim /etc/my.cnf</code>ã€‚</p><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code># ä¸»æœåŠ¡å™¨å”¯ä¸€ID
server-id=1
# å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—
log-bin=mysql-bin
# è®¾ç½®ä¸è¦å¤åˆ¶çš„æ•°æ®åº“(å¯è®¾ç½®å¤šä¸ª)
binlog-ignore-db=mysql
binlog-ignore-db=information_schema
# è®¾ç½®éœ€è¦å¤åˆ¶çš„æ•°æ®åº“ï¼Œbinlog-do-db=éœ€è¦å¤åˆ¶çš„ä¸»æ•°æ®åº“åå­—
binlog-do-db=testdb
# è®¾ç½® logbin æ ¼å¼
binlog_format=STATEMENT

datadir=/var/lib/mysql
socket=/var/lib/mysql/mysql.sock

log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>binlog</code>æ—¥å¿—ä¸‰ç§æ ¼å¼ï¼š</p><ul><li><code>Statement</code>ï¼šæ¯ä¸€æ¡ä¼šä¿®æ”¹æ•°æ®çš„<code>sql</code>éƒ½ä¼šè®°å½•åœ¨<code>binlog</code>ä¸­ <ul><li><p>ä¼˜ç‚¹ï¼š</p><ul><li>ä¸éœ€è¦è®°å½•æ¯ä¸€è¡Œçš„å˜åŒ–ï¼Œå‡å°‘äº†<code>binlog</code>æ—¥å¿—é‡ï¼ŒèŠ‚çº¦äº†<code>IO</code>ï¼Œæé«˜æ€§èƒ½</li><li>ç›¸æ¯”<code>row</code>èƒ½èŠ‚çº¦å¤šå°‘æ€§èƒ½ä¸æ—¥å¿—é‡ï¼Œè¿™ä¸ªå–å†³äºåº”ç”¨çš„<code>SQL</code>æƒ…å†µï¼Œæ­£å¸¸åŒä¸€æ¡è®°å½•ä¿®æ”¹æˆ–è€…æ’å…¥<code>row</code>æ ¼å¼æ‰€äº§ç”Ÿçš„æ—¥å¿—é‡è¿˜å°äº<code>Statement</code>äº§ç”Ÿçš„æ—¥å¿—é‡ï¼Œä½†æ˜¯è€ƒè™‘åˆ°å¦‚æœå¸¦æ¡ä»¶çš„<code>update</code>æ“ä½œï¼Œä»¥åŠæ•´è¡¨åˆ é™¤ï¼Œ<code>alter</code>è¡¨ç­‰æ“ä½œï¼Œ<code>ROW</code>æ ¼å¼ä¼šäº§ç”Ÿå¤§é‡æ—¥å¿—ï¼Œå› æ­¤åœ¨è€ƒè™‘æ˜¯å¦ä½¿ç”¨<code>ROW</code>æ ¼å¼æ—¥å¿—æ—¶åº”è¯¥è·Ÿæ®åº”ç”¨çš„å®é™…æƒ…å†µï¼Œå…¶æ‰€äº§ç”Ÿçš„æ—¥å¿—é‡ä¼šå¢åŠ å¤šå°‘ï¼Œä»¥åŠå¸¦æ¥çš„<code>IO</code>æ€§èƒ½é—®é¢˜</li></ul></li><li><p>ç¼ºç‚¹ï¼š</p><ul><li>ç”±äºè®°å½•çš„åªæ˜¯æ‰§è¡Œè¯­å¥ï¼Œä¸ºäº†è¿™äº›è¯­å¥èƒ½åœ¨<code>slave</code>ä¸Šæ­£ç¡®è¿è¡Œï¼Œå› æ­¤è¿˜å¿…é¡»è®°å½•æ¯æ¡è¯­å¥åœ¨æ‰§è¡Œçš„æ—¶å€™çš„ä¸€äº›ç›¸å…³ä¿¡æ¯ï¼Œä»¥ä¿è¯æ‰€æœ‰è¯­å¥èƒ½åœ¨<code>slave</code>å¾—åˆ°å’Œ<code>master</code>ç«¯æ‰§è¡Œæ—¶å€™ç›¸åŒçš„ç»“æœ</li><li>å¦å¤–<code>MySsql</code>çš„å¤åˆ¶ï¼Œåƒä¸€äº›ç‰¹å®šå‡½æ•°åŠŸèƒ½ï¼Œ<code>slave</code>å¯ä¸<code>master</code>ä¸Šè¦ä¿æŒä¸€è‡´ä¼šæœ‰å¾ˆå¤šç›¸å…³é—®é¢˜ï¼ˆå¦‚<code>sleep()</code>å‡½æ•°ï¼Œ<code>last_insert_id()</code>ï¼Œä»¥åŠ<code>user-defined functions(udf)</code>ä¼šå‡ºç°é—®é¢˜ï¼‰</li></ul></li></ul></li><li><code>Row</code>ï¼šä¸è®°å½•<code>sql</code>è¯­å¥ä¸Šä¸‹æ–‡ç›¸å…³ä¿¡æ¯ï¼Œä»…ä¿å­˜å“ªæ¡è®°å½•è¢«ä¿®æ”¹ <ul><li>ä¼˜ç‚¹ï¼š<code>binlog</code>ä¸­å¯ä»¥ä¸è®°å½•æ‰§è¡Œçš„<code>sql</code>è¯­å¥çš„ä¸Šä¸‹æ–‡ç›¸å…³çš„ä¿¡æ¯ï¼Œä»…éœ€è¦è®°å½•é‚£ä¸€æ¡è®°å½•è¢«ä¿®æ”¹æˆä»€ä¹ˆäº†ï¼›æ‰€ä»¥<code>ROW-level</code>çš„æ—¥å¿—å†…å®¹ä¼šéå¸¸æ¸…æ¥šçš„è®°å½•ä¸‹æ¯ä¸€è¡Œæ•°æ®ä¿®æ”¹çš„ç»†èŠ‚ï¼Œè€Œä¸”ä¸ä¼šå‡ºç°æŸäº›ç‰¹å®šæƒ…å†µä¸‹çš„å­˜å‚¨è¿‡ç¨‹ï¼Œæˆ–<code>function</code>ï¼Œä»¥åŠ<code>trigger</code>çš„è°ƒç”¨å’Œè§¦å‘æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„é—®é¢˜ã€‚</li><li>ç¼ºç‚¹ï¼šæ‰€æœ‰çš„æ‰§è¡Œçš„è¯­å¥å½“è®°å½•åˆ°æ—¥å¿—ä¸­çš„æ—¶å€™ï¼Œéƒ½å°†ä»¥æ¯è¡Œè®°å½•çš„ä¿®æ”¹æ¥è®°å½•ï¼Œè¿™æ ·å¯èƒ½ä¼šäº§ç”Ÿå¤§é‡çš„æ—¥å¿—å†…å®¹ï¼›æ¯”å¦‚ä¸€æ¡<code>update</code>è¯­å¥ï¼Œä¿®æ”¹å¤šæ¡è®°å½•ï¼Œåˆ™<code>binlog</code>ä¸­æ¯ä¸€æ¡ä¿®æ”¹éƒ½ä¼šæœ‰è®°å½•ï¼Œè¿™æ ·é€ æˆ<code>binlog</code>æ—¥å¿—é‡ä¼šå¾ˆå¤§ï¼Œç‰¹åˆ«æ˜¯å½“æ‰§è¡Œ<code>alter table</code>ä¹‹ç±»çš„è¯­å¥çš„æ—¶å€™ï¼Œç”±äºè¡¨ç»“æ„ä¿®æ”¹ï¼Œæ¯æ¡è®°å½•éƒ½å‘ç”Ÿæ”¹å˜ï¼Œé‚£ä¹ˆè¯¥è¡¨æ¯ä¸€æ¡è®°å½•éƒ½ä¼šè®°å½•åˆ°æ—¥å¿—ä¸­ã€‚</li></ul></li><li><code>Mixedlevel</code>ï¼šæ˜¯ä»¥ä¸Šä¸¤ç§<code>level</code>çš„æ··åˆä½¿ç”¨ <ul><li>ä¸€èˆ¬çš„è¯­å¥ä¿®æ”¹ä½¿ç”¨<code>Statment</code>æ ¼å¼ä¿å­˜<code>binlog</code>ï¼Œå¦‚ä¸€äº›å‡½æ•°ï¼Œ<code>Statement</code>æ— æ³•å®Œæˆä¸»ä»å¤åˆ¶çš„æ“ä½œï¼Œåˆ™é‡‡ç”¨<code>ROW</code>æ ¼å¼ä¿å­˜<code>binlog</code>ï¼›<code>MySql</code>ä¼šæ ¹æ®æ‰§è¡Œçš„æ¯ä¸€æ¡å…·ä½“çš„<code>sql</code>è¯­å¥æ¥åŒºåˆ†å¯¹å¾…è®°å½•çš„æ—¥å¿—å½¢å¼ï¼Œä¹Ÿå°±æ˜¯åœ¨<code>Statement</code>å’Œ<code>Row</code>ä¹‹é—´é€‰æ‹©ä¸€ç§ï¼Œæ–°ç‰ˆæœ¬çš„<code>MySql</code>ä¸­å¯¹<code>ROW-level</code>æ¨¡å¼ä¹Ÿè¢«åšäº†ä¼˜åŒ–ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ä¿®æ”¹éƒ½ä¼šä»¥<code>ROW-level</code>æ¥è®°å½•ï¼Œåƒé‡åˆ°è¡¨ç»“æ„å˜æ›´çš„æ—¶å€™å°±ä¼šä»¥<code>Statement</code>æ¨¡å¼æ¥è®°å½•ï¼›è‡³äº<code>update</code>æˆ–è€…<code>delete</code>ç­‰ä¿®æ”¹æ•°æ®çš„è¯­å¥ï¼Œè¿˜æ˜¯ä¼šè®°å½•æ‰€æœ‰è¡Œçš„å˜æ›´ã€‚</li></ul></li></ul></li><li><p>ä»æœºé…ç½®ï¼ˆ<a href="192.168.30.130">192.168.30.130</a>ï¼‰<br> ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š<code>vim /etc/my.cnf</code>ã€‚</p><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code># ä»æœåŠ¡å™¨å”¯ä¸€ID
server-id=2
# å¯ç”¨ä¸­ç»§æ—¥å¿—
relay-log=mysql-relay

datadir=/var/lib/mysql
socket=/var/lib/mysql/mysql.sock

log-error=/var/log/mysqld.log
pid-file=/var/run/mysqld/mysqld.pid
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä¸»æœºã€ä»æœºé‡å¯<code>MySQL</code>æœåŠ¡</p></li><li><p>ä¸»æœºä»æœºéƒ½å…³é—­é˜²ç«å¢™</p></li><li><p>åœ¨ä¸»æœºä¸Šå»ºç«‹å¸æˆ·å¹¶æˆæƒ<code>slave</code></p><ul><li>åœ¨ä¸»æœº<code>MySql</code>é‡Œæ‰§è¡Œæˆæƒå‘½ä»¤<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> global <span class="token assign-left variable">validate_password_policy</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> global <span class="token assign-left variable">validate_password_length</span><span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> GRANT REPLICATION SLAVE ON *.* TO <span class="token string">&#39;slave&#39;</span>@<span class="token string">&#39;%&#39;</span> IDENTIFIED BY <span class="token string">&#39;123456&#39;</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>æŸ¥è¯¢<code>master</code>çš„çŠ¶æ€<br> è®°å½•ä¸‹<code>File</code>å’Œ<code>Position</code>çš„å€¼ï¼Œæ‰§è¡Œå®Œæ­¤æ­¥éª¤åä¸è¦å†æ“ä½œä¸»æœåŠ¡å™¨<code>MySql</code>ï¼Œé˜²æ­¢ä¸»æœåŠ¡å™¨çŠ¶æ€å€¼å˜åŒ–ã€‚<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> show master status<span class="token punctuation">;</span>
+------------------+----------+--------------+--------------------------+-------------------+
<span class="token operator">|</span> File             <span class="token operator">|</span> Position <span class="token operator">|</span> Binlog_Do_DB <span class="token operator">|</span> Binlog_Ignore_DB         <span class="token operator">|</span> Executed_Gtid_Set <span class="token operator">|</span>
+------------------+----------+--------------+--------------------------+-------------------+
<span class="token operator">|</span> mysql-bin.000001 <span class="token operator">|</span>      <span class="token number">430</span> <span class="token operator">|</span> testdb       <span class="token operator">|</span> mysql,information_schema <span class="token operator">|</span>                   <span class="token operator">|</span>
+------------------+----------+--------------+--------------------------+-------------------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>åœ¨ä»æœºä¸Šé…ç½®éœ€è¦å¤åˆ¶çš„ä¸»æœº</p><ul><li><p>å¤åˆ¶ä¸»æœº</p><ul><li>å¤åˆ¶ä¸»æœºçš„å‘½ä»¤<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>CHANGE MASTER TO <span class="token assign-left variable">MASTER_HOST</span><span class="token operator">=</span><span class="token string">&#39;ä¸»æœºçš„IPåœ°å€&#39;</span>,
<span class="token assign-left variable">MASTER_USER</span><span class="token operator">=</span><span class="token string">&#39;slave&#39;</span>,
<span class="token assign-left variable">MASTER_PASSWORD</span><span class="token operator">=</span><span class="token string">&#39;123456&#39;</span>,
<span class="token assign-left variable">MASTER_LOG_FILE</span><span class="token operator">=</span><span class="token string">&#39;mysql-bin.å…·ä½“æ•°å­—&#39;</span>,MASTER_LOG_POS<span class="token operator">=</span>å…·ä½“å€¼<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>è¾“å…¥<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>CHANGE MASTER TO <span class="token assign-left variable">MASTER_HOST</span><span class="token operator">=</span><span class="token string">&#39;192.168.30.134&#39;</span>,
<span class="token assign-left variable">MASTER_USER</span><span class="token operator">=</span><span class="token string">&#39;slave&#39;</span>,
<span class="token assign-left variable">MASTER_PASSWORD</span><span class="token operator">=</span><span class="token string">&#39;123456&#39;</span>,
<span class="token assign-left variable">MASTER_LOG_FILE</span><span class="token operator">=</span><span class="token string">&#39;mysql-bin.000001&#39;</span>,MASTER_LOG_POS<span class="token operator">=</span><span class="token number">430</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>å¯åŠ¨ä»æœåŠ¡å™¨å¤åˆ¶åŠŸèƒ½</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> start slave<span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected, <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥çœ‹ä»æœåŠ¡å™¨çŠ¶æ€</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> show slave status<span class="token punctuation">\</span>G
*************************** <span class="token number">1</span>. row ***************************
               Slave_IO_State: Waiting <span class="token keyword">for</span> <span class="token builtin class-name">source</span> to send event
                  Master_Host: <span class="token number">192.168</span>.30.134
                  Master_User: slave
                  Master_Port: <span class="token number">3306</span>
                Connect_Retry: <span class="token number">60</span>
              Master_Log_File: mysql-bin.000001
          Read_Master_Log_Pos: <span class="token number">974</span>
               Relay_Log_File: mysql-relay.000002
                Relay_Log_Pos: <span class="token number">324</span>
        Relay_Master_Log_File: mysql-bin.000001
             Slave_IO_Running: Yes
            Slave_SQL_Running: Yes
<span class="token punctuation">..</span>.
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹é¢ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯Yesï¼Œåˆ™è¯´æ˜ä¸»ä»é…ç½®æˆåŠŸï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Slave_IO_Running: Yes
Slave_SQL_Running: Yes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>ä¸»æœºæ–°å»ºåº“ã€æ–°å»ºè¡¨ã€<code>insert</code>è®°å½•ï¼Œä»æœºå¤åˆ¶</p><ul><li>ä¸»æœº<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> show databases<span class="token punctuation">;</span>
+--------------------+
<span class="token operator">|</span> Database           <span class="token operator">|</span>
+--------------------+
<span class="token operator">|</span> information_schema <span class="token operator">|</span>
<span class="token operator">|</span> mysql              <span class="token operator">|</span>
<span class="token operator">|</span> performance_schema <span class="token operator">|</span>
<span class="token operator">|</span> sys                <span class="token operator">|</span>
+--------------------+
<span class="token number">4</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> create database testdb<span class="token punctuation">;</span>
Query OK, <span class="token number">1</span> row affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> use testdb<span class="token punctuation">;</span>
Database changed
mysql<span class="token operator">&gt;</span> show tables<span class="token punctuation">;</span>
Empty <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> create table mytbl<span class="token punctuation">(</span>id int, name varchar<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.04</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> insert into mytbl values<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token string">&#39;zhang3&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK, <span class="token number">1</span> row affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> * from mytbl<span class="token punctuation">;</span>
+------+--------+
<span class="token operator">|</span> <span class="token function">id</span>   <span class="token operator">|</span> name   <span class="token operator">|</span>
+------+--------+
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> zhang3 <span class="token operator">|</span>
+------+--------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>ä»æœº<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> show databases<span class="token punctuation">;</span>
+--------------------+
<span class="token operator">|</span> Database           <span class="token operator">|</span>
+--------------------+
<span class="token operator">|</span> information_schema <span class="token operator">|</span>
<span class="token operator">|</span> mysql              <span class="token operator">|</span>
<span class="token operator">|</span> performance_schema <span class="token operator">|</span>
<span class="token operator">|</span> sys                <span class="token operator">|</span>
+--------------------+
<span class="token number">4</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> show databases<span class="token punctuation">;</span>
+--------------------+
<span class="token operator">|</span> Database           <span class="token operator">|</span>
+--------------------+
<span class="token operator">|</span> information_schema <span class="token operator">|</span>
<span class="token operator">|</span> mysql              <span class="token operator">|</span>
<span class="token operator">|</span> performance_schema <span class="token operator">|</span>
<span class="token operator">|</span> sys                <span class="token operator">|</span>
<span class="token operator">|</span> testdb             <span class="token operator">|</span>
+--------------------+
<span class="token number">5</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> use testdb<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> show tables<span class="token punctuation">;</span>
+------------------+
<span class="token operator">|</span> Tables_in_testdb <span class="token operator">|</span>
+------------------+
<span class="token operator">|</span> mytbl            <span class="token operator">|</span>
+------------------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> * from mytbl<span class="token punctuation">;</span>
+------+--------+
<span class="token operator">|</span> <span class="token function">id</span>   <span class="token operator">|</span> name   <span class="token operator">|</span>
+------+--------+
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> zhang3 <span class="token operator">|</span>
+------+--------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>å¦‚ä½•åœæ­¢ä»æœåŠ¡å¤åˆ¶åŠŸèƒ½</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> stop slave<span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å¦‚ä½•é‡æ–°é…ç½®ä¸»ä»</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql<span class="token operator">&gt;</span> stop slave<span class="token punctuation">;</span> 
mysql<span class="token operator">&gt;</span> reset master<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></li><li><p>ä¿®æ”¹<code>MyCat</code>çš„é…ç½®æ–‡ä»¶<code>schema.xml</code><br> ä¿®æ”¹çš„<code>balance</code>å±æ€§ï¼Œé€šè¿‡æ­¤å±æ€§é…ç½®è¯»å†™åˆ†ç¦»çš„ç±»å‹ã€‚è´Ÿè½½å‡è¡¡ç±»å‹ï¼Œç›®å‰çš„å–å€¼æœ‰ 4 ç§ï¼š</p><ol><li><code>balance=&quot;0&quot;</code>ï¼šä¸å¼€å¯è¯»å†™åˆ†ç¦»æœºåˆ¶ï¼Œæ‰€æœ‰è¯»æ“ä½œéƒ½å‘é€åˆ°å½“å‰å¯ç”¨çš„<code>writeHost</code>ä¸Š</li><li><code>balance=&quot;1&quot;</code>ï¼šå…¨éƒ¨çš„<code>readHost</code>ä¸<code>stand by writeHost</code>å‚ä¸<code>select</code>è¯­å¥çš„è´Ÿè½½å‡è¡¡ï¼Œç®€å•çš„è¯´ï¼Œå½“åŒä¸»åŒä»æ¨¡å¼ï¼ˆ<code>M1-&gt;S1</code>ï¼Œ<code>M2-&gt;S2</code>ï¼Œå¹¶ä¸”<code>M1</code>ä¸<code>M2</code>äº’ä¸ºä¸»å¤‡ï¼‰ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œ<code>M2</code>ã€<code>S1</code>ã€<code>S2</code>éƒ½å‚ä¸<code>select</code>è¯­å¥çš„è´Ÿè½½å‡è¡¡</li><li><code>balance=&quot;2&quot;</code>ï¼šæ‰€æœ‰è¯»æ“ä½œéƒ½éšæœºçš„åœ¨<code>writeHost</code>ã€<code>readhost</code>ä¸Šåˆ†å‘</li><li><code>balance=&quot;3&quot;</code>ï¼šæ‰€æœ‰è¯»è¯·æ±‚éšæœºçš„åˆ†å‘åˆ°<code>readhost</code>æ‰§è¡Œï¼Œ<code>writerHost</code>ä¸è´Ÿæ‹…è¯»å‹åŠ›</li></ol><p>ä¸ºäº†èƒ½çœ‹åˆ°è¯»å†™åˆ†ç¦»çš„æ•ˆæœï¼ŒæŠŠ<code>balance</code>è®¾ç½®æˆ 2ï¼Œä¼šåœ¨ä¸¤ä¸ªä¸»æœºé—´åˆ‡æ¢æŸ¥è¯¢ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>2<span class="token punctuation">&quot;</span></span>
                          <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>jdbc<span class="token punctuation">&quot;</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>select user()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å¯åŠ¨<code>MyCat</code></p></li><li><p>éªŒè¯è¯»å†™åˆ†ç¦»</p><ul><li>åœ¨å†™ä¸»æœºæ•°æ®åº“è¡¨<code>mytbl</code>ä¸­æ’å…¥å¸¦ç³»ç»Ÿå˜é‡æ•°æ®ï¼Œé€ æˆä¸»ä»æ•°æ®ä¸ä¸€è‡´<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># å†™ä¸»æœºä¸­æ’å…¥å¹¶æŸ¥è¯¢</span>
mysql<span class="token operator">&gt;</span> INSERT INTO mytbl VALUES<span class="token punctuation">(</span><span class="token number">2</span>,@@hostname<span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK, <span class="token number">1</span> row affected, <span class="token number">1</span> warning <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> * from mytbl<span class="token punctuation">;</span>
+------+----------+
<span class="token operator">|</span> <span class="token function">id</span>   <span class="token operator">|</span> name     <span class="token operator">|</span>
+------+----------+
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> zhang3   <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> centos02 <span class="token operator">|</span>
+------+----------+
<span class="token number">2</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>
<span class="token comment"># è¯»ä¸»æœºä»æŸ¥è¯¢</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> * from mytbl<span class="token punctuation">;</span>
+------+----------+
<span class="token operator">|</span> <span class="token function">id</span>   <span class="token operator">|</span> name     <span class="token operator">|</span>
+------+----------+
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> zhang3   <span class="token operator">|</span>
<span class="token operator">|</span>    <span class="token number">2</span> <span class="token operator">|</span> centos03 <span class="token operator">|</span>
+------+----------+
<span class="token number">2</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>åœ¨<code>MyCat</code>é‡ŒæŸ¥è¯¢<code>mytbl</code>è¡¨ï¼Œå¯ä»¥çœ‹åˆ°æŸ¥è¯¢è¯­å¥åœ¨ä¸»ä»ä¸¤ä¸ªä¸»æœºé—´åˆ‡æ¢<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># -A æ˜¯ä¸é¢„è¯»å–æ•°æ®åº“ï¼ŒæŸ¥è¯¢æ¯”è¾ƒå¿«</span>
<span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># mysql -umycat -p123456 -P 8066 -h 192.168.30.134 -A</span>

mysql<span class="token operator">&gt;</span> show databases<span class="token punctuation">;</span>
+----------+
<span class="token operator">|</span> DATABASE <span class="token operator">|</span>
+----------+
<span class="token operator">|</span> TESTDB   <span class="token operator">|</span>
+----------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> use TESTDB<span class="token punctuation">;</span>
Database changed
mysql<span class="token operator">&gt;</span> show tables<span class="token punctuation">;</span>
+------------------+
<span class="token operator">|</span> Tables <span class="token keyword">in</span> TESTDB <span class="token operator">|</span>
+------------------+
<span class="token operator">|</span> mytbl            <span class="token operator">|</span>
+------------------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ol><h3 id="åŒä¸»åŒä»" tabindex="-1"><a class="header-anchor" href="#åŒä¸»åŒä»" aria-hidden="true">#</a> åŒä¸»åŒä»</h3><p>ä¸€ä¸ªä¸»æœº<code>M1</code>ç”¨äºå¤„ç†æ‰€æœ‰å†™è¯·æ±‚ï¼Œå®ƒçš„ä»æœº<code>S1</code>å’Œå¦ä¸€å°ä¸»æœº<code>M2</code>è¿˜æœ‰å®ƒçš„ä»æœº<code>S2</code>è´Ÿè´£æ‰€æœ‰è¯»è¯·<br> æ±‚ã€‚å½“<code>M1</code>ä¸»æœºå®•æœºåï¼Œ<code>M2</code>ä¸»æœºè´Ÿè´£å†™è¯·æ±‚ï¼Œ<code>M1</code>ã€<code>M2</code>äº’ä¸ºå¤‡æœºã€‚</p><p>æ¶æ„å›¾å¦‚ä¸‹ï¼š</p><figure><img src="https://cdn.jsdelivr.net/gh/1coins/assets/mycat-summary/two-master-two-slave.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><table><thead><tr><th>ç¼–å·</th><th>è§’è‰²</th><th>IP</th><th>æœºå™¨å</th></tr></thead><tbody><tr><td>1</td><td>M1</td><td>192.168.30.134</td><td>centos02.02</td></tr><tr><td>2</td><td>S1</td><td>192.168.30.130</td><td>centos03.03</td></tr><tr><td>3</td><td>M2</td><td>192.168.30.129</td><td>centos01.01</td></tr><tr><td>4</td><td>S2</td><td>192.168.30.131</td><td>cdntos04.04</td></tr></tbody></table><ol><li><p>æ­å»º<code>MySql</code>æ•°æ®åº“ä¸»ä»å¤åˆ¶ï¼ˆåŒä¸»åŒä»ï¼‰</p><ol><li><p>åŒä¸»æœºé…ç½®<br> ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š<code>vim /etc/my.cnf</code>ã€‚</p><ul><li><code>M1</code><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code># ä¸»æœåŠ¡å™¨å”¯ä¸€ ID
server-id=1
# å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—
log-bin=mysql-bin
# è®¾ç½®ä¸è¦å¤åˆ¶çš„æ•°æ®åº“ï¼ˆå¯è®¾ç½®å¤šä¸ªï¼‰
binlog-ignore-db=mysql
binlog-ignore-db=information_schema
# è®¾ç½®éœ€è¦å¤åˆ¶çš„æ•°æ®åº“
binlog-do-db=éœ€è¦å¤åˆ¶çš„ä¸»æ•°æ®åº“åå­—
# è®¾ç½® logbin æ ¼å¼
binlog_format=STATEMENT
# åœ¨ä½œä¸ºä»æ•°æ®åº“çš„æ—¶å€™ï¼Œæœ‰å†™å…¥æ“ä½œä¹Ÿè¦æ›´æ–°äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶
log-slave-updates 
# è¡¨ç¤ºè‡ªå¢é•¿å­—æ®µæ¯æ¬¡é€’å¢çš„é‡ï¼ŒæŒ‡è‡ªå¢å­—æ®µçš„èµ·å§‹å€¼ï¼Œå…¶é»˜è®¤å€¼æ˜¯ 1ï¼Œå–å€¼èŒƒå›´æ˜¯ 1 .. 65535
auto-increment-increment=2 
# è¡¨ç¤ºè‡ªå¢é•¿å­—æ®µä»å“ªä¸ªæ•°å¼€å§‹ï¼ŒæŒ‡å­—æ®µä¸€æ¬¡é€’å¢å¤šå°‘ï¼Œå–å€¼èŒƒå›´æ˜¯ 1 .. 65535
auto-increment-offset=1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><code>M2</code><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code># ä¸»æœåŠ¡å™¨å”¯ä¸€ ID
server-id=3
# å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—
log-bin=mysql-bin
# è®¾ç½®ä¸è¦å¤åˆ¶çš„æ•°æ®åº“ï¼ˆå¯è®¾ç½®å¤šä¸ªï¼‰
binlog-ignore-db=mysql
binlog-ignore-db=information_schema
# è®¾ç½®éœ€è¦å¤åˆ¶çš„æ•°æ®åº“
binlog-do-db=éœ€è¦å¤åˆ¶çš„ä¸»æ•°æ®åº“åå­—
# è®¾ç½® logbin æ ¼å¼
binlog_format=STATEMENT
# åœ¨ä½œä¸ºä»æ•°æ®åº“çš„æ—¶å€™ï¼Œæœ‰å†™å…¥æ“ä½œä¹Ÿè¦æ›´æ–°äºŒè¿›åˆ¶æ—¥å¿—æ–‡ä»¶
log-slave-updates 
# è¡¨ç¤ºè‡ªå¢é•¿å­—æ®µæ¯æ¬¡é€’å¢çš„é‡ï¼ŒæŒ‡è‡ªå¢å­—æ®µçš„èµ·å§‹å€¼ï¼Œå…¶é»˜è®¤å€¼æ˜¯ 1ï¼Œå–å€¼èŒƒå›´æ˜¯ 1 .. 65535
auto-increment-increment=2 
# è¡¨ç¤ºè‡ªå¢é•¿å­—æ®µä»å“ªä¸ªæ•°å¼€å§‹ï¼ŒæŒ‡å­—æ®µä¸€æ¬¡é€’å¢å¤šå°‘ï¼Œå–å€¼èŒƒå›´æ˜¯ 1 .. 65535
auto-increment-offset=2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>åŒä¸»æœºé…ç½®<br> ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š<code>vim /etc/my.cnf</code>ã€‚</p><ul><li><code>S1</code><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code># ä»æœåŠ¡å™¨å”¯ä¸€ ID
server-id=2
# å¯ç”¨ä¸­ç»§æ—¥å¿—
relay-log=mysql-relay
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><code>S2</code><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code># ä»æœåŠ¡å™¨å”¯ä¸€ ID
server-id=4
# å¯ç”¨ä¸­ç»§æ—¥å¿—
relay-log=mysql-relay
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>åŒä¸»æœºã€åŒä»æœºé‡å¯<code>MySql</code>æœåŠ¡</p></li><li><p>ä¸»æœºä»æœºéƒ½å…³é—­é˜²ç«å¢™</p></li><li><p>åœ¨ä¸¤å°ä¸»æœºä¸Šå»ºç«‹å¸æˆ·å¹¶æˆæƒ<code>slave</code></p><ul><li>åœ¨ä¸»æœº<code>MySql</code>é‡Œæ‰§è¡Œæˆæƒå‘½ä»¤<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>GRANT REPLICATION SLAVE ON *.* TO <span class="token string">&#39;slave&#39;</span>@<span class="token string">&#39;%&#39;</span> IDENTIFIED BY <span class="token string">&#39;123456&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>æŸ¥è¯¢<code>M1</code>çš„çŠ¶æ€<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>show master status<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>æŸ¥è¯¢<code>M2</code>çš„çŠ¶æ€<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>show master status<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><p>åˆ†åˆ«è®°å½•ä¸‹<code>File</code>å’Œ<code>Position</code>çš„å€¼ï¼Œæ‰§è¡Œå®Œæ­¤æ­¥éª¤åä¸è¦å†æ“ä½œä¸»æœåŠ¡å™¨<code>MySql</code>ï¼Œé˜²æ­¢ä¸»æœåŠ¡å™¨çŠ¶æ€å€¼å˜åŒ–</p></li><li><p>åœ¨ä»æœºä¸Šé…ç½®éœ€è¦å¤åˆ¶çš„ä¸»æœº<br><code>S1</code>å¤åˆ¶<code>M1</code>ï¼Œ<code>S2</code>å¤åˆ¶<code>M2</code>ã€‚</p><ul><li>å¤åˆ¶ä¸»æœºçš„å‘½ä»¤<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>CHANGE MASTER TO <span class="token assign-left variable">MASTER_HOST</span><span class="token operator">=</span><span class="token string">&#39;ä¸»æœºçš„IPåœ°å€&#39;</span>,
<span class="token assign-left variable">MASTER_USER</span><span class="token operator">=</span><span class="token string">&#39;slave&#39;</span>,
<span class="token assign-left variable">MASTER_PASSWORD</span><span class="token operator">=</span><span class="token string">&#39;123456&#39;</span>,
<span class="token assign-left variable">MASTER_LOG_FILE</span><span class="token operator">=</span><span class="token string">&#39;mysql-bin.å…·ä½“æ•°å­—&#39;</span>,MASTER_LOG_POS<span class="token operator">=</span>å…·ä½“å€¼<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>å¯åŠ¨ä¸¤å°ä»æœåŠ¡å™¨å¤åˆ¶åŠŸèƒ½<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>start slave<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>æŸ¥çœ‹ä»æœåŠ¡å™¨çŠ¶æ€<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>show slave status<span class="token punctuation">\</span>G<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ul><p>ä¸‹é¢ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯<code>Yes</code>ï¼Œåˆ™è¯´æ˜ä¸»ä»é…ç½®æˆåŠŸï¼</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Slave_IO_Running: Yes
Slave_SQL_Running: Yes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä¸¤ä¸ªä¸»æœºäº’ç›¸å¤åˆ¶<br><code>M2</code>å¤åˆ¶<code>M1</code>ï¼Œ<code>M1</code>å¤åˆ¶<code>M2</code>ï¼Œå¦‚ä¸Šã€‚</p></li><li><p><code>M1</code>ä¸»æœºæ–°å»ºåº“ã€æ–°å»ºè¡¨ã€<code>insert</code>è®°å½•ï¼Œ<code>M2</code>å’Œ<code>S1</code>ã€<code>S2</code>å¤åˆ¶</p></li><li><p>åœæ­¢ä»æœåŠ¡å¤åˆ¶åŠŸèƒ½</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>stop slave<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>é‡æ–°é…ç½®ä¸»ä»</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>stop slave<span class="token punctuation">;</span> 
reset master<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></li><li><p>ä¿®æ”¹<code>Mycat</code>çš„é…ç½®æ–‡ä»¶<code>schema.xml</code><br> ä¿®æ”¹çš„<code>balance</code>å±æ€§ï¼Œé€šè¿‡æ­¤å±æ€§é…ç½®è¯»å†™åˆ†ç¦»çš„ç±»å‹ï¼Œä¸ºäº†åŒä¸»åŒä»è¯»å†™åˆ†ç¦»<code>balance</code>è®¾ç½®ä¸º 1ã€‚</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>testdb<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>native<span class="token punctuation">&quot;</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>select user()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- can have multi write hosts --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostM1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.140.124:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- can have multi read hosts --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>readHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostS1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.140.130:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostM2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.140.129:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- can have multi read hosts --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>readHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostS2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.140.125:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataHost</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>writeType=&quot;0&quot;</code>ï¼šæ‰€æœ‰å†™æ“ä½œå‘é€åˆ°é…ç½®çš„ç¬¬ä¸€ä¸ª<code>writeHost</code>ï¼Œç¬¬ä¸€ä¸ªæŒ‚äº†åˆ‡åˆ°è¿˜ç”Ÿå­˜çš„ç¬¬äºŒä¸ª</li><li><code>writeType=&quot;1&quot;</code>ï¼Œæ‰€æœ‰å†™æ“ä½œéƒ½éšæœºçš„å‘é€åˆ°é…ç½®çš„<code>writeHost</code>ï¼Œ1.5 ä»¥ååºŸå¼ƒä¸æ¨è</li><li><code>writeHost</code>ï¼Œé‡æ–°å¯åŠ¨åä»¥åˆ‡æ¢åçš„ä¸ºå‡†ï¼Œåˆ‡æ¢è®°å½•åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼š<code>dnindex.properties</code></li><li><code>switchType=&quot;1&quot;</code><ul><li>1 ï¼šé»˜è®¤å€¼ï¼Œè‡ªåŠ¨åˆ‡æ¢</li><li>-1 ï¼šä¸è‡ªåŠ¨åˆ‡æ¢</li><li>2 ï¼šåŸºäº<code>MySql</code>ä¸»ä»åŒæ­¥çš„çŠ¶æ€å†³å®šæ˜¯å¦åˆ‡æ¢</li></ul></li></ul></li><li><p>å¯åŠ¨<code>MyCat</code></p></li><li><p>éªŒè¯è¯»å†™åˆ†ç¦»</p><ul><li>åœ¨å†™ä¸»æœº<code>M1</code>æ•°æ®åº“è¡¨<code>mytbl</code>ä¸­æ’å…¥å¸¦ç³»ç»Ÿå˜é‡æ•°æ®ï¼Œé€ æˆä¸»ä»æ•°æ®ä¸ä¸€è‡´<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mytbl <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>@<span class="token variable">@hostname</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>åœ¨<code>MyCat</code>é‡ŒæŸ¥è¯¢<code>mytbl</code>è¡¨ï¼Œå¯ä»¥çœ‹åˆ°æŸ¥è¯¢è¯­å¥åœ¨<code>M2(centos01)</code>ã€<code>S1(centos03)</code>ã€<code>S2(centos04)</code>ä¸»ä»ä¸‰ä¸ªä¸»æœºé—´åˆ‡æ¢</li></ul></li><li><p>æŠ—é£é™©èƒ½åŠ›</p><ol><li>åœæ­¢æ•°æ®åº“<code>M1</code></li><li>åœ¨<code>MyCat</code>é‡Œæ’å…¥æ•°æ®ä¾ç„¶æˆåŠŸï¼Œ<code>M2</code>è‡ªåŠ¨åˆ‡æ¢ä¸ºå†™ä¸»æœº<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> mytbl <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span>@<span class="token variable">@hostname</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>å¯åŠ¨æ•°æ®åº“<code>M1</code></li><li>åœ¨<code>MyCat</code>é‡ŒæŸ¥è¯¢<code>mytbl</code>è¡¨,å¯ä»¥çœ‹åˆ°æŸ¥è¯¢è¯­å¥åœ¨<code>M1(centos02)</code>ã€<code>S1(centos03)</code>ã€<code>S2(centos04)</code>ä¸»ä»ä¸‰ä¸ªä¸»æœºé—´åˆ‡æ¢</li></ol><p><code>M1</code>ã€<code>M2</code>äº’åšå¤‡æœºï¼Œè´Ÿè´£å†™çš„ä¸»æœºå®•æœºï¼Œå¤‡æœºåˆ‡æ¢è´Ÿè´£å†™æ“ä½œï¼Œä¿è¯æ•°æ®åº“è¯»å†™åˆ†ç¦»é«˜å¯ç”¨æ€§ã€‚</p></li></ol><h2 id="å‚ç›´æ‹†åˆ†â€”â€”åˆ†åº“" tabindex="-1"><a class="header-anchor" href="#å‚ç›´æ‹†åˆ†â€”â€”åˆ†åº“" aria-hidden="true">#</a> å‚ç›´æ‹†åˆ†â€”â€”åˆ†åº“</h2><p>ä¸€ä¸ªæ•°æ®åº“ç”±å¾ˆå¤šè¡¨çš„æ„æˆï¼Œæ¯ä¸ªè¡¨å¯¹åº”ç€ä¸åŒçš„ä¸šåŠ¡ï¼Œå‚ç›´åˆ‡åˆ†æ˜¯æŒ‡æŒ‰ç…§ä¸šåŠ¡å°†è¡¨è¿›è¡Œåˆ†ç±»ï¼Œ<br>åˆ†å¸ƒåˆ°ä¸åŒ çš„æ•°æ®åº“ä¸Šé¢ï¼Œè¿™æ ·ä¹Ÿå°±å°†æ•°æ®æˆ–è€…è¯´å‹åŠ›åˆ†æ‹…åˆ°ä¸åŒçš„åº“ä¸Šé¢ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="https://cdn.jsdelivr.net/gh/1coins/assets/mycat-summary/vertical-shard.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ç³»ç»Ÿè¢«åˆ‡åˆ†æˆäº†ï¼Œç”¨æˆ·ï¼Œè®¢å•äº¤æ˜“ï¼Œæ”¯ä»˜å‡ ä¸ªæ¨¡å—ã€‚</p><h3 id="å¦‚ä½•åˆ’åˆ†è¡¨" tabindex="-1"><a class="header-anchor" href="#å¦‚ä½•åˆ’åˆ†è¡¨" aria-hidden="true">#</a> å¦‚ä½•åˆ’åˆ†è¡¨</h3><p>é—®é¢˜ï¼šåœ¨ä¸¤å°ä¸»æœºä¸Šçš„ä¸¤ä¸ªæ•°æ®åº“ä¸­çš„è¡¨ï¼Œèƒ½å¦å…³è”æŸ¥è¯¢ï¼Ÿ</p><p>ç­”æ¡ˆï¼šä¸å¯ä»¥å…³è”æŸ¥è¯¢ã€‚</p><p>åˆ†åº“çš„åŸåˆ™ï¼šæœ‰ç´§å¯†å…³è”å…³ç³»çš„è¡¨åº”è¯¥åœ¨ä¸€ä¸ªåº“é‡Œï¼Œç›¸äº’æ²¡æœ‰å…³è”å…³ç³»çš„è¡¨å¯ä»¥åˆ†åˆ°ä¸åŒçš„åº“é‡Œã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">// å®¢æˆ·è¡¨ rowsï¼š20 ä¸‡</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> customer<span class="token punctuation">(</span>
    id <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// è®¢å•è¡¨ rowsï¼š600 ä¸‡</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> orders<span class="token punctuation">(</span>
    id <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    order_type <span class="token keyword">INT</span><span class="token punctuation">,</span>
    customer_id <span class="token keyword">INT</span><span class="token punctuation">,</span>
    amount <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">// è®¢å•è¯¦ç»†è¡¨ rowsï¼š600 ä¸‡</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> orders_detail<span class="token punctuation">(</span>
    id <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    detail <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    order_id <span class="token keyword">INT</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// è®¢å•çŠ¶æ€å­—å…¸è¡¨ rowsï¼š20</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> dict_order_type<span class="token punctuation">(</span>
    id <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
    order_type <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šå››ä¸ªè¡¨å¦‚ä½•åˆ†åº“ï¼Ÿ</p><p>å®¢æˆ·è¡¨åˆ†åœ¨ä¸€ä¸ªæ•°æ®åº“ï¼Œå¦å¤–ä¸‰å¼ éƒ½éœ€è¦å…³è”æŸ¥è¯¢ï¼Œåˆ†åœ¨å¦å¤–ä¸€ä¸ªæ•°æ®åº“ã€‚</p><h3 id="å®ç°åˆ†åº“" tabindex="-1"><a class="header-anchor" href="#å®ç°åˆ†åº“" aria-hidden="true">#</a> å®ç°åˆ†åº“</h3><ol><li>ä¿®æ”¹<code>schema.xml</code>é…ç½®æ–‡ä»¶<div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schema</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>TESTDB<span class="token punctuation">&quot;</span></span> <span class="token attr-name">checkSQLschema</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">sqlMaxLimit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>customer<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn2<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schema</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataNode</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataHost</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">database</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>native<span class="token punctuation">&quot;</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>select user()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- can have multi write hosts --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostM1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.140.128:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataHost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataHost</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minCon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10<span class="token punctuation">&quot;</span></span> <span class="token attr-name">balance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">writeType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbDriver</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>native<span class="token punctuation">&quot;</span></span> <span class="token attr-name">switchType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">slaveThreshold</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heartbeat</span><span class="token punctuation">&gt;</span></span>select user()<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heartbeat</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- can have multi write hosts --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>writeHost</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hostM2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.140.127:3306<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span> <span class="token attr-name">password</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>123456<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>writeHost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataHost</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>æ–°å¢ä¸¤ä¸ªç©ºç™½åº“<br> åˆ†åº“æ“ä½œä¸æ˜¯åœ¨åŸæ¥çš„è€æ•°æ®åº“ä¸Šè¿›è¡Œæ“ä½œï¼Œéœ€è¦å‡†å¤‡ä¸¤å°æœºå™¨åˆ†åˆ«å®‰è£…æ–°çš„æ•°æ®åº“ï¼Œåœ¨æ•°æ®èŠ‚ç‚¹<code>dn1</code>ã€<code>dn2</code>ä¸Šåˆ†åˆ«åˆ›å»ºæ•°æ®åº“<code>orders</code>ã€‚<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> orders<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>å¯åŠ¨<code>MyCat</code></li><li>è®¿é—®<code>MyCat</code>è¿›è¡Œåˆ†åº“ <ol><li>è®¿é—®<code>MyCat</code><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-umycat</span> <span class="token parameter variable">-p123456</span> <span class="token parameter variable">-h</span> <span class="token number">192.168</span>.140.134 <span class="token parameter variable">-P</span> <span class="token number">8066</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>åˆ‡æ¢åˆ°<code>TESTDB</code></li><li>åˆ›å»º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>4</mn></mrow><annotation encoding="application/x-tex">4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">4</span></span></span></span> å¼ è¡¨</li><li>åœ¨<code>dn1</code>å’Œ<code>dn2</code>ä¸ŠæŸ¥çœ‹è¡¨ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸåˆ†åº“</li></ol></li></ol><h2 id="æ°´å¹³æ‹†åˆ†â€”â€”åˆ†è¡¨" tabindex="-1"><a class="header-anchor" href="#æ°´å¹³æ‹†åˆ†â€”â€”åˆ†è¡¨" aria-hidden="true">#</a> æ°´å¹³æ‹†åˆ†â€”â€”åˆ†è¡¨</h2><p>ç›¸å¯¹äºå‚ç›´æ‹†åˆ†ï¼Œæ°´å¹³æ‹†åˆ†ä¸æ˜¯å°†è¡¨åšåˆ†ç±»ï¼Œè€Œæ˜¯æŒ‰ç…§æŸä¸ªå­—æ®µçš„æŸç§è§„åˆ™æ¥åˆ†æ•£åˆ°å¤šä¸ªåº“ä¹‹ä¸­ï¼Œæ¯ä¸ªè¡¨ä¸­åŒ…å«ä¸€éƒ¨åˆ†æ•°æ®ã€‚ç®€å•æ¥è¯´ï¼Œå¯ä»¥å°†æ•°æ®çš„æ°´å¹³åˆ‡åˆ†ç†è§£ä¸ºæ˜¯æŒ‰ç…§æ•°æ®è¡Œçš„åˆ‡åˆ†ï¼Œå°±æ˜¯å°†è¡¨ä¸­çš„æŸäº›è¡Œåˆ‡åˆ†åˆ°ä¸€ä¸ªæ•°æ®åº“ï¼Œè€Œå¦å¤–çš„æŸäº›è¡Œåˆåˆ‡åˆ†åˆ°å…¶ä»–çš„æ•°æ®åº“ä¸­ï¼Œå¦‚å›¾ï¼š</p><p>![](<a href="https://cdn.jsdelivr.net/gh/1coins/assets/mycat-summary/horizontal" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/1coins/assets/mycat-summary/horizontal<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> -shard.png)</p><h3 id="å®ç°åˆ†è¡¨" tabindex="-1"><a class="header-anchor" href="#å®ç°åˆ†è¡¨" aria-hidden="true">#</a> å®ç°åˆ†è¡¨</h3><ol><li>é€‰æ‹©è¦æ‹†åˆ†çš„è¡¨<br><code>MySql</code>å•è¡¨å­˜å‚¨æ•°æ®æ¡æ•°æ˜¯æœ‰ç“¶é¢ˆçš„ï¼Œå•è¡¨è¾¾åˆ° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1000</mn></mrow><annotation encoding="application/x-tex">1000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1000</span></span></span></span> ä¸‡æ¡æ•°æ®å°±è¾¾åˆ°äº†ç“¶é¢ˆï¼Œä¼šå½±å“æŸ¥è¯¢æ•ˆç‡ï¼Œéœ€è¦è¿›è¡Œæ°´å¹³æ‹†åˆ†ï¼ˆåˆ†è¡¨ï¼‰è¿›è¡Œä¼˜åŒ–ã€‚<br><code>orders</code>ã€<code>orders_detail</code>éƒ½å·²ç»è¾¾åˆ° <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>600</mn></mrow><annotation encoding="application/x-tex">600</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">600</span></span></span></span> ä¸‡è¡Œæ•°æ®ï¼Œéœ€è¦è¿›è¡Œåˆ†è¡¨ä¼˜åŒ–ã€‚</li><li>åˆ†è¡¨å­—æ®µ<br> ä»¥<code>orders</code>è¡¨ä¸ºä¾‹ï¼Œå¯ä»¥æ ¹æ®ä¸åŒè‡ªå­—æ®µè¿›è¡Œåˆ†è¡¨ <table><thead><tr><th>ç¼–å·</th><th>åˆ†è¡¨å­—æ®µ</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>1</td><td><code>id</code>ï¼ˆä¸»é”®ã€æˆ–åˆ›å»ºæ—¶é—´ï¼‰</td><td>æŸ¥è¯¢è®¢å•æ³¨é‡æ—¶æ•ˆï¼Œå†å²è®¢å•è¢«æŸ¥è¯¢çš„æ¬¡æ•°å°‘ï¼Œå¦‚æ­¤åˆ†ç‰‡ä¼šé€ æˆä¸€ä¸ªèŠ‚ç‚¹è®¿é—®å¤šï¼Œä¸€ä¸ªè®¿é—®å°‘ï¼Œä¸å¹³å‡ã€‚</td></tr><tr><td>2</td><td><code>customer_id</code>ï¼ˆå®¢æˆ·<code>id</code>ï¼‰</td><td>æ ¹æ®å®¢æˆ·<code>id</code>å»åˆ†ï¼Œä¸¤ä¸ªèŠ‚ç‚¹è®¿é—®å¹³å‡ï¼Œä¸€ä¸ªå®¢æˆ·çš„æ‰€æœ‰è®¢å•éƒ½åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹</td></tr></tbody></table></li><li>ä¿®æ”¹é…ç½®æ–‡ä»¶<code>schema.xml</code><br> ä¸º<code>orders</code>è¡¨è®¾ç½®æ•°æ®èŠ‚ç‚¹ä¸º<code>dn1</code>ã€<code>dn2</code>ï¼Œå¹¶æŒ‡å®šåˆ†ç‰‡è§„åˆ™ä¸º<code>mod_rule</code>ï¼ˆè‡ªå®šä¹‰çš„åå­—ï¼‰<div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod_rule<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>ä¿®æ”¹é…ç½®æ–‡ä»¶<code>rule.xml</code><br> åœ¨<code>rule</code>é…ç½®æ–‡ä»¶é‡Œæ–°å¢åˆ†ç‰‡è§„åˆ™<code>mod_rule</code>ï¼Œå¹¶æŒ‡å®šè§„åˆ™é€‚ç”¨å­—æ®µä¸º<code>customer_id</code>ï¼Œè¿˜æœ‰é€‰æ‹©åˆ†ç‰‡ç®—æ³•<code>mod-long</code>ï¼ˆå¯¹å­—æ®µæ±‚æ¨¡è¿ç®—ï¼‰ï¼Œ<code>customer_id</code>å¯¹ä¸¤ä¸ªèŠ‚ç‚¹æ±‚æ¨¡ï¼Œæ ¹æ®ç»“æœåˆ†ç‰‡ï¼Œé…ç½®ç®—æ³•<code>mod-long</code>å‚æ•°<code>count</code>ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>ï¼Œåˆ†æˆä¸¤ä¸ªèŠ‚ç‚¹ã€‚<div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod_rule<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>customer_id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>mod-long<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>
â€¦
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod-long<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.PartitionByMod<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- how many data nodes --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>åœ¨æ•°æ®èŠ‚ç‚¹<code>dn2</code>ä¸Šå»º<code>orders</code>è¡¨</li><li>é‡å¯<code>MyCat</code>ï¼Œè®©é…ç½®ç”Ÿæ•ˆ</li><li>è®¿é—®<code>MyCat</code>å®ç°åˆ†ç‰‡ <ul><li>åœ¨<code>MyCat</code>é‡Œå‘<code>orders</code>è¡¨æ’å…¥æ•°æ®ï¼Œ<code>INSERT</code>å­—æ®µä¸èƒ½çœç•¥<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> orders<span class="token punctuation">(</span>id<span class="token punctuation">,</span>order_type<span class="token punctuation">,</span>customer_id<span class="token punctuation">,</span>amount<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> orders<span class="token punctuation">(</span>id<span class="token punctuation">,</span>order_type<span class="token punctuation">,</span>customer_id<span class="token punctuation">,</span>amount<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> orders<span class="token punctuation">(</span>id<span class="token punctuation">,</span>order_type<span class="token punctuation">,</span>customer_id<span class="token punctuation">,</span>amount<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">120000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> orders<span class="token punctuation">(</span>id<span class="token punctuation">,</span>order_type<span class="token punctuation">,</span>customer_id<span class="token punctuation">,</span>amount<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">103000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> orders<span class="token punctuation">(</span>id<span class="token punctuation">,</span>order_type<span class="token punctuation">,</span>customer_id<span class="token punctuation">,</span>amount<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">100400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> orders<span class="token punctuation">(</span>id<span class="token punctuation">,</span>order_type<span class="token punctuation">,</span>customer_id<span class="token punctuation">,</span>amount<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100020</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>åœ¨<code>MyCat</code>ã€<code>dn1</code>ã€<code>dn2</code>ä¸­æŸ¥çœ‹<code>orders</code>è¡¨æ•°æ®ï¼Œåˆ†è¡¨æˆåŠŸ</li></ul></li></ol><h3 id="mycat-åˆ†ç‰‡åçš„-join-æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#mycat-åˆ†ç‰‡åçš„-join-æŸ¥è¯¢" aria-hidden="true">#</a> Mycat åˆ†ç‰‡åçš„ join æŸ¥è¯¢</h3><p><code>orders</code>è®¢å•è¡¨å·²ç»è¿›è¡Œåˆ†è¡¨æ“ä½œäº†ï¼Œå’Œå®ƒå…³è”çš„<code>orders_detail</code>è®¢å•è¯¦æƒ…è¡¨å¦‚ä½•è¿›è¡Œ<code>join</code>æŸ¥è¯¢ã€‚</p><p>å¯¹<code>orders_detail</code>ä¹Ÿè¦è¿›è¡Œåˆ†ç‰‡æ“ä½œã€‚</p><p><code>Join</code>çš„åŸç†å¦‚ä¸‹å›¾ï¼š</p><p>![](<a href="https://cdn.jsdelivr.net/gh/1coins/assets/mycat-summary/mycat-join-horizontal" target="_blank" rel="noopener noreferrer">https://cdn.jsdelivr.net/gh/1coins/assets/mycat-summary/mycat-join-horizontal<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> -shard.png)</p><ol><li><p><code>ER</code>è¡¨<br><code>MyCat</code>å€Ÿé‰´äº†<code>NewSql</code>é¢†åŸŸçš„æ–°ç§€<code>Foundation DB</code>çš„è®¾è®¡æ€è·¯ï¼Œ<code>Foundation DB</code>åˆ›æ–°æ€§çš„æ<br>å‡ºäº†<code>Table Group</code>çš„æ¦‚å¿µï¼Œå…¶å°†å­è¡¨çš„å­˜å‚¨ä½ç½®ä¾èµ–äºä¸»è¡¨ï¼Œå¹¶ä¸”ç‰©ç†ä¸Šç´§é‚»å­˜æ”¾ï¼Œå› æ­¤å½»åº•è§£å†³äº†<code>Join</code>çš„æ•ˆç‡å’Œæ€§èƒ½é—®é¢˜ï¼›æ ¹æ®è¿™ä¸€æ€è·¯ï¼Œæå‡ºäº†åŸºäº<code>E-R</code>å…³ç³»çš„æ•°æ®åˆ†ç‰‡ç­–ç•¥ï¼Œå­è¡¨çš„è®°å½•ä¸æ‰€å…³è”çš„çˆ¶è¡¨è®°å½•å­˜æ”¾åœ¨åŒä¸€ä¸ªæ•°æ®åˆ†ç‰‡ä¸Šã€‚</p><ol><li>ä¿®æ”¹<code>schema.xml</code>é…ç½®æ–‡ä»¶<div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod_rule<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>childTable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders_detail<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">joinKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>order_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parentKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>åœ¨<code>dn2</code>åˆ›å»º<code>orders_detail</code>è¡¨</li><li>é‡å¯<code>MyCat</code></li><li>è®¿é—®<code>MyCat</code>å‘<code>orders_detail</code>è¡¨æ’å…¥æ•°æ®<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> orders_detail<span class="token punctuation">(</span>id<span class="token punctuation">,</span>detail<span class="token punctuation">,</span>order_id<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#39;detail1&#39;</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> orders_detail<span class="token punctuation">(</span>id<span class="token punctuation">,</span>detail<span class="token punctuation">,</span>order_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&#39;detail1&#39;</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> orders_detail<span class="token punctuation">(</span>id<span class="token punctuation">,</span>detail<span class="token punctuation">,</span>order_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&#39;detail1&#39;</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> orders_detail<span class="token punctuation">(</span>id<span class="token punctuation">,</span>detail<span class="token punctuation">,</span>order_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">&#39;detail1&#39;</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> orders_detail<span class="token punctuation">(</span>id<span class="token punctuation">,</span>detail<span class="token punctuation">,</span>order_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">&#39;detail1&#39;</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> orders_detail<span class="token punctuation">(</span>id<span class="token punctuation">,</span>detail<span class="token punctuation">,</span>order_id<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token string">&#39;detail1&#39;</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>åœ¨<code>MyCat</code>ã€<code>dn1</code>ã€<code>dn2</code>ä¸­è¿è¡Œä¸¤ä¸ªè¡¨<code>join</code>è¯­å¥<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">Select</span> o<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>od<span class="token punctuation">.</span>detail <span class="token keyword">from</span> orders o <span class="token keyword">inner</span> <span class="token keyword">join</span> orders_detail od <span class="token keyword">on</span> o<span class="token punctuation">.</span>id<span class="token operator">=</span>od<span class="token punctuation">.</span>order_id<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol></li><li><p>å…¨å±€è¡¨<br> åœ¨åˆ†ç‰‡çš„æƒ…å†µä¸‹ï¼Œå½“ä¸šåŠ¡è¡¨å› ä¸ºè§„æ¨¡è€Œè¿›è¡Œåˆ†ç‰‡ä»¥åï¼Œä¸šåŠ¡è¡¨ä¸è¿™äº›é™„å±çš„å­—å…¸è¡¨ä¹‹é—´çš„å…³è”ï¼Œ<br> å°±æˆäº†æ¯”è¾ƒ æ£˜æ‰‹çš„é—®é¢˜ï¼Œè€ƒè™‘åˆ°å­—å…¸è¡¨å…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹æ€§ï¼š</p><ul><li>å˜åŠ¨ä¸é¢‘ç¹</li><li>æ•°æ®é‡æ€»ä½“å˜åŒ–ä¸å¤§</li><li>æ•°æ®è§„æ¨¡ä¸å¤§ï¼Œå¾ˆå°‘æœ‰è¶…è¿‡æ•°åä¸‡æ¡è®°å½•</li></ul><p>é‰´äºæ­¤ï¼Œ<code>MyCat</code>å®šä¹‰äº†ä¸€ç§ç‰¹æ®Šçš„è¡¨ï¼Œç§°ä¹‹ä¸ºâ€œå…¨å±€è¡¨â€ï¼Œå…¨å±€è¡¨å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ul><li>å…¨å±€è¡¨çš„æ’å…¥ã€æ›´æ–°æ“ä½œä¼šå®æ—¶åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šæ‰§è¡Œï¼Œä¿æŒå„ä¸ªåˆ†ç‰‡çš„æ•°æ®ä¸€è‡´æ€§</li><li>å…¨å±€è¡¨çš„æŸ¥è¯¢æ“ä½œï¼Œåªä»ä¸€ä¸ªèŠ‚ç‚¹è·å–</li><li>å…¨å±€è¡¨å¯ä»¥è·Ÿä»»ä½•ä¸€ä¸ªè¡¨è¿›è¡Œ<code>Join</code>æ“ä½œ</li></ul><p>å°†å­—å…¸è¡¨æˆ–è€…ç¬¦åˆå­—å…¸è¡¨ç‰¹æ€§çš„ä¸€äº›è¡¨å®šä¹‰ä¸ºå…¨å±€è¡¨ï¼Œåˆ™ä»å¦å¤–ä¸€ä¸ªæ–¹é¢ï¼Œå¾ˆå¥½çš„è§£å†³äº†æ•°æ®<code>Join</code>çš„éš¾é¢˜ã€‚é€šè¿‡å…¨å±€è¡¨+åŸºäº<code>E-R</code>å…³ç³»çš„åˆ†ç‰‡ç­–ç•¥ï¼Œ<code>MyCat</code>å¯ä»¥æ»¡è¶³ 80 % ä»¥ä¸Šçš„ä¼ä¸šåº”ç”¨å¼€å‘ã€‚</p><ol><li>ä¿®æ”¹<code>schema.xml</code>é…ç½®æ–‡ä»¶<div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mod_rule<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>childTable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders_detail<span class="token punctuation">&quot;</span></span> <span class="token attr-name">primaryKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">joinKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>order_id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">parentKey</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dict_order_type<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>global<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>åœ¨<code>dn2</code>åˆ›å»º<code>dict_order_type</code>è¡¨</li><li>é‡å¯<code>MyCat</code></li><li>è®¿é—®<code>MyCat</code>å‘<code>dict_order_type</code>è¡¨æ’å…¥æ•°æ®<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> dict_order_type<span class="token punctuation">(</span>id<span class="token punctuation">,</span>order_type<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token string">&#39;type1&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> dict_order_type<span class="token punctuation">(</span>id<span class="token punctuation">,</span>order_type<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">&#39;type2&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li>åœ¨<code>MyCat</code>ã€<code>dn1</code>ã€<code>dn2</code>ä¸­æŸ¥è¯¢è¡¨æ•°æ®<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> dict_order_type<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol></li></ol><h3 id="å¸¸ç”¨åˆ†ç‰‡è§„åˆ™" tabindex="-1"><a class="header-anchor" href="#å¸¸ç”¨åˆ†ç‰‡è§„åˆ™" aria-hidden="true">#</a> å¸¸ç”¨åˆ†ç‰‡è§„åˆ™</h3><ol><li>å–æ¨¡<br> æ­¤è§„åˆ™ä¸ºå¯¹åˆ†ç‰‡å­—æ®µæ±‚æ‘¸è¿ç®—ã€‚ä¹Ÿæ˜¯æ°´å¹³åˆ†è¡¨æœ€å¸¸ç”¨è§„åˆ™ã€‚åœ¨<strong>å®ç°åˆ†è¡¨</strong>ä¸­ï¼Œ<code>orders</code>è¡¨é‡‡ç”¨äº†æ­¤è§„åˆ™ã€‚</li><li>åˆ†ç‰‡æšä¸¾<br> é€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®å¯èƒ½çš„æšä¸¾<code>id</code>ï¼Œè‡ªå·±é…ç½®åˆ†ç‰‡ï¼Œæœ¬è§„åˆ™é€‚ç”¨äºç‰¹å®šçš„åœºæ™¯ï¼Œæ¯”å¦‚æœ‰äº›ä¸šåŠ¡éœ€è¦æŒ‰ç…§çœä»½æˆ–åŒºå¿æ¥åšä¿å­˜ï¼Œè€Œå…¨å›½çœä»½åŒºå¿å›ºå®šçš„ï¼Œè¿™ç±»ä¸šåŠ¡ä½¿ç”¨æœ¬æ¡è§„åˆ™ã€‚ <ol><li><p>ä¿®æ”¹<code>schema.xml</code>é…ç½®æ–‡ä»¶</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders_ware_info<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding_by_intfile<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ä¿®æ”¹<code>rule.xml</code>é…ç½®æ–‡ä»¶</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding_by_intfile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>areacode<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>hash-int<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>
......
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hash-int<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.PartitionByFileMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapFile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>partition-hash-int.txt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>type<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>defaultNode<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>columns</code>ï¼šåˆ†ç‰‡å­—æ®µ</li><li><code>algorithm</code>ï¼šåˆ†ç‰‡å‡½æ•°</li><li><code>mapFile</code>ï¼šæ ‡è¯†é…ç½®æ–‡ä»¶åç§°</li><li><code>type</code>ï¼š0 ä¸º<code>int</code>å‹ã€é 0 ä¸º<code>String</code></li><li><code>defaultNode</code>ï¼šé»˜è®¤èŠ‚ç‚¹ï¼Œå°äº 0 è¡¨ç¤ºä¸è®¾ç½®é»˜è®¤èŠ‚ç‚¹ï¼Œå¤§äºç­‰äº 0 è¡¨ç¤ºè®¾ç½®é»˜è®¤èŠ‚ç‚¹ï¼Œè®¾ç½®é»˜è®¤èŠ‚ç‚¹å¦‚æœç¢°åˆ°ä¸è¯†åˆ«çš„æšä¸¾å€¼ï¼Œå°±è®©å®ƒè·¯ç”±åˆ°é»˜è®¤èŠ‚ç‚¹ï¼Œå¦‚ä¸è®¾ç½®ä¸è¯†åˆ«å°±æŠ¥é”™</li></ul></li><li><p>ä¿®æ”¹<code>partition-hash-int.txt</code>é…ç½®æ–‡ä»¶</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>110=0
120=1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>é‡å¯<code>MyCat</code></p></li><li><p>è®¿é—®<code>MyCat</code>åˆ›å»ºè¡¨</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">// è®¢å•å½’å±åŒºåŸŸä¿¡æ¯è¡¨</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> orders_ware_info<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">comment</span> <span class="token string">&#39;ç¼–å·&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token keyword">comment</span> <span class="token string">&#39;è®¢å•ç¼–å·&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>address<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">comment</span> <span class="token string">&#39;åœ°å€&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>areacode<span class="token punctuation">`</span></span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">comment</span> <span class="token string">&#39;åŒºåŸŸç¼–å·&#39;</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ’å…¥æ•°æ®</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> orders_ware_info<span class="token punctuation">(</span>id<span class="token punctuation">,</span> order_id<span class="token punctuation">,</span>address<span class="token punctuation">,</span>areacode<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&#39;åŒ—äº¬&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;110&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> orders_ware_info<span class="token punctuation">(</span>id<span class="token punctuation">,</span> order_id<span class="token punctuation">,</span>address<span class="token punctuation">,</span>areacode<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&#39;å¤©æ´¥&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;120&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢<code>MyCat</code>ã€<code>dn1</code>ã€<code>dn2</code>å¯ä»¥çœ‹åˆ°æ•°æ®åˆ†ç‰‡æ•ˆæœ</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> orders_ware_info<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol></li><li>èŒƒå›´çº¦å®š<br> æ­¤åˆ†ç‰‡é€‚ç”¨äºï¼Œæå‰è§„åˆ’å¥½åˆ†ç‰‡å­—æ®µæŸä¸ªèŒƒå›´å±äºå“ªä¸ªåˆ†ç‰‡ã€‚ <ol><li><p>ä¿®æ”¹<code>schema.xml</code>é…ç½®æ–‡ä»¶</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>payment_info<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>auto_sharding_long<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ä¿®æ”¹<code>rule.xml</code>é…ç½®æ–‡ä»¶</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>auto_sharding_long<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>order_id<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>rang-long<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>
......
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rang-long<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.AutoPartitionByLong<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mapFile<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>autopartition-long.txt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>defaultNode<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>columns</code>ï¼šåˆ†ç‰‡å­—æ®µ</li><li><code>algorithm</code>ï¼šåˆ†ç‰‡å‡½æ•°</li><li><code>mapFile</code>ï¼šæ ‡è¯†é…ç½®æ–‡ä»¶åç§°</li><li><code>defaultNode</code>ï¼šé»˜è®¤èŠ‚ç‚¹ï¼Œå°äº 0 è¡¨ç¤ºä¸è®¾ç½®é»˜è®¤èŠ‚ç‚¹ï¼Œå¤§äºç­‰äº 0 è¡¨ç¤ºè®¾ç½®é»˜è®¤èŠ‚ç‚¹ï¼Œè®¾ç½®é»˜è®¤èŠ‚ç‚¹å¦‚æœç¢°åˆ°ä¸è¯†åˆ«çš„æšä¸¾å€¼ï¼Œå°±è®©å®ƒè·¯ç”±åˆ°é»˜è®¤èŠ‚ç‚¹ï¼Œå¦‚ä¸è®¾ç½®ä¸è¯†åˆ«å°±æŠ¥é”™</li></ul></li><li><p>ä¿®æ”¹<code>autopartition-long.txt</code>é…ç½®æ–‡ä»¶</p><div class="language-txt line-numbers-mode" data-ext="txt"><pre class="language-txt"><code>0-102=0
103-200=1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>é‡å¯<code>MyCat</code></p></li><li><p>è®¿é—®<code>MyCat</code>åˆ›å»ºè¡¨</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">// æ”¯ä»˜ä¿¡æ¯è¡¨ </span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> payment_info<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">comment</span> <span class="token string">&#39;ç¼–å·&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>order_id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token keyword">comment</span> <span class="token string">&#39;è®¢å•ç¼–å·&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>payment_status<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token keyword">comment</span> <span class="token string">&#39;æ”¯ä»˜çŠ¶æ€&#39;</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ’å…¥æ•°æ®</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> payment_info <span class="token punctuation">(</span>id<span class="token punctuation">,</span>order_id<span class="token punctuation">,</span>payment_status<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> payment_info <span class="token punctuation">(</span>id<span class="token punctuation">,</span>order_id<span class="token punctuation">,</span>payment_status<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> payment_info <span class="token punctuation">(</span>id<span class="token punctuation">,</span>order_id <span class="token punctuation">,</span>payment_status<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> payment_info <span class="token punctuation">(</span>id<span class="token punctuation">,</span>order_id<span class="token punctuation">,</span>payment_status<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢<code>MyCat</code>ã€<code>dn1</code>ã€<code>dn2</code>å¯ä»¥çœ‹åˆ°æ•°æ®åˆ†ç‰‡æ•ˆæœ</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> payment_info<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol></li><li>æŒ‰æ—¥æœŸï¼ˆå¤©ï¼‰åˆ†ç‰‡<br> æ­¤è§„åˆ™ä¸ºæŒ‰å¤©åˆ†ç‰‡ã€‚è®¾å®šæ—¶é—´æ ¼å¼ã€èŒƒå›´ <ol><li><p>ä¿®æ”¹<code>schema.xml</code>é…ç½®æ–‡ä»¶</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>login_info<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dataNode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dn1,dn2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rule</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding_by_date<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>ä¿®æ”¹<code>rule.xml</code>é…ç½®æ–‡ä»¶</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tableRule</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sharding_by_date<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rule</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>columns</span><span class="token punctuation">&gt;</span></span>login_date<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>columns</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>algorithm</span><span class="token punctuation">&gt;</span></span>shardingByDate<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>algorithm</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rule</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tableRule</span><span class="token punctuation">&gt;</span></span>
......
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>function</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>shardingByDate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>io.mycat.route.function.PartitionByDate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dateFormat<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>yyyy-MM-dd<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sBeginDate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2019-01-01<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sEndDate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2019-01-04<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sPartionDay<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>function</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>columns</code>ï¼šåˆ†ç‰‡å­—æ®µ</li><li><code>algorithm</code>ï¼šåˆ†ç‰‡å‡½æ•°</li><li><code>dateFormat</code>ï¼šæ—¥æœŸæ ¼å¼</li><li><code>sBeginDate</code>ï¼šå¼€å§‹æ—¥æœŸ</li><li><code>sEndDate</code>ï¼šç»“æŸæ—¥æœŸ,åˆ™ä»£è¡¨æ•°æ®è¾¾åˆ°äº†è¿™ä¸ªæ—¥æœŸçš„åˆ†ç‰‡åå¾ªç¯ä»å¼€å§‹åˆ†ç‰‡</li><li><code>sPartionDay</code>ï¼šåˆ†åŒºå¤©æ•°ï¼Œå³é»˜è®¤ä»å¼€å§‹æ—¥æœŸç®—èµ·ï¼Œåˆ†éš” 2 å¤©ä¸€ä¸ªåˆ†åŒº</li></ul></li><li><p>é‡å¯<code>MyCat</code></p></li><li><p>è®¿é—®<code>MyCat</code>åˆ›å»ºè¡¨</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">// ç”¨æˆ·ä¿¡æ¯è¡¨ </span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> login_info<span class="token punctuation">(</span>
    <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">comment</span> <span class="token string">&#39;ç¼–å·&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span> <span class="token keyword">comment</span> <span class="token string">&#39;ç”¨æˆ·ç¼–å·&#39;</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>login_date<span class="token punctuation">`</span></span> <span class="token keyword">date</span> <span class="token keyword">comment</span> <span class="token string">&#39;ç™»å½•æ—¥æœŸ&#39;</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ’å…¥æ•°æ®</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> login_info<span class="token punctuation">(</span>id<span class="token punctuation">,</span>user_id<span class="token punctuation">,</span>login_date<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token string">&#39;2019-01-01&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> login_info<span class="token punctuation">(</span>id<span class="token punctuation">,</span>user_id<span class="token punctuation">,</span>login_date<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token string">&#39;2019-01-02&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> login_info<span class="token punctuation">(</span>id<span class="token punctuation">,</span>user_id<span class="token punctuation">,</span>login_date<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token string">&#39;2019-01-03&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> login_info<span class="token punctuation">(</span>id<span class="token punctuation">,</span>user_id<span class="token punctuation">,</span>login_date<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token string">&#39;2019-01-04&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> login_info<span class="token punctuation">(</span>id<span class="token punctuation">,</span>user_id<span class="token punctuation">,</span>login_date<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token string">&#39;2019-01-05&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> login_info<span class="token punctuation">(</span>id<span class="token punctuation">,</span>user_id<span class="token punctuation">,</span>login_date<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token string">&#39;2019-01-06&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢<code>MyCat</code>ã€<code>dn1</code>ã€<code>dn2</code>å¯ä»¥çœ‹åˆ°æ•°æ®åˆ†ç‰‡æ•ˆæœ</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> login_info<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol></li></ol><h3 id="å…¨å±€åºåˆ—" tabindex="-1"><a class="header-anchor" href="#å…¨å±€åºåˆ—" aria-hidden="true">#</a> å…¨å±€åºåˆ—</h3><p>åœ¨å®ç°åˆ†åº“åˆ†è¡¨çš„æƒ…å†µä¸‹ï¼Œæ•°æ®åº“è‡ªå¢ä¸»é”®å·²æ— æ³•ä¿è¯è‡ªå¢ä¸»é”®çš„å…¨å±€å”¯ä¸€ï¼›ä¸ºæ­¤ï¼Œ<code>MyCat</code>æä¾›äº†å…¨å±€<code>sequence</code>ï¼Œå¹¶ä¸”æä¾›äº†åŒ…å«æœ¬åœ°é…ç½®å’Œæ•°æ®åº“é…ç½®ç­‰å¤šç§å®ç°æ–¹å¼ã€‚</p><ol><li><p>æœ¬åœ°æ–‡ä»¶<br> æ­¤æ–¹å¼<code>MyCat</code>å°†<code>sequence</code>é…ç½®åˆ°æ–‡ä»¶ä¸­ï¼Œå½“ä½¿ç”¨åˆ°<code>sequence</code>ä¸­çš„é…ç½®åï¼Œ<code>MyCat</code>ä¼šæ›´ä¸‹<code>classpath</code>ä¸­çš„<code>sequence_conf.properties</code>æ–‡ä»¶ä¸­<code>sequence</code>å½“å‰çš„å€¼ã€‚</p><ul><li>ä¼˜ç‚¹ï¼šæœ¬åœ°åŠ è½½ï¼Œè¯»å–é€Ÿåº¦è¾ƒå¿«C</li><li>ç¼ºç‚¹ï¼šæŠ—é£é™©èƒ½åŠ›å·®ï¼Œ<code>MyCat</code>æ‰€åœ¨ä¸»æœºå®•æœºåï¼Œæ— æ³•è¯»å–æœ¬åœ°æ–‡ä»¶</li></ul></li><li><p>æ•°æ®åº“æ–¹å¼<br> åˆ©ç”¨æ•°æ®åº“ä¸€ä¸ªè¡¨ æ¥è¿›è¡Œè®¡æ•°ç´¯åŠ ã€‚ä½†æ˜¯å¹¶ä¸æ˜¯æ¯æ¬¡ç”Ÿæˆåºåˆ—éƒ½è¯»å†™æ•°æ®åº“ï¼Œè¿™æ ·æ•ˆç‡å¤ªä½ã€‚</p><p><code>MyCat</code>ä¼šé¢„åŠ è½½ä¸€éƒ¨åˆ†å·æ®µåˆ°<code>MyCat</code>çš„å†…å­˜ä¸­ï¼Œè¿™æ ·å¤§éƒ¨åˆ†è¯»å†™åºåˆ—éƒ½æ˜¯åœ¨å†…å­˜ä¸­å®Œæˆçš„ï¼Œå¦‚æœå†…å­˜ä¸­çš„å·æ®µç”¨å®Œäº†<code>MyCat</code>ä¼šå†å‘æ•°æ®åº“è¦ä¸€æ¬¡ã€‚<br> é—®ï¼šå¦‚æœ<code>MyCat</code>å´©æºƒäº†ï¼Œé‚£å†…å­˜ä¸­çš„åºåˆ—å²‚ä¸æ˜¯éƒ½æ²¡äº†ï¼Ÿ<br>ç­”ï¼šæ˜¯çš„ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆ<code>MyCat</code>å¯åŠ¨åä¼šå‘æ•°æ®åº“ç”³è¯·æ–°çš„å·æ®µï¼ŒåŸæœ‰å·æ®µä¼šå¼ƒç”¨ï¼›ä¹Ÿå°±æ˜¯è¯´å¦‚æœ<code>MyCat</code>é‡å¯ï¼Œé‚£ä¹ˆæŸå¤±æ˜¯å½“å‰çš„å·æ®µæ²¡ç”¨å®Œçš„å·ç ï¼Œä½†æ˜¯ä¸ä¼šå› æ­¤å‡ºç°ä¸»é”®é‡å¤ã€‚</p><ol><li><p>å»ºåº“åºåˆ—è„šæœ¬</p><ol><li><p>åœ¨<code>dn1</code>ä¸Šåˆ›å»ºå…¨å±€åºåˆ—è¡¨</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> MYCAT_SEQUENCE <span class="token punctuation">(</span>NAME <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>current_value <span class="token keyword">INT</span> <span class="token operator">NOT</span>
<span class="token boolean">NULL</span><span class="token punctuation">,</span>increment <span class="token keyword">INT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">(</span>NAME<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">INNODB</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åˆ›å»ºå…¨å±€åºåˆ—æ‰€éœ€å‡½æ•°</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">DELIMITER</span> $$ 
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> mycat_seq_currval<span class="token punctuation">(</span>seq_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">RETURNS</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span>
<span class="token keyword">DETERMINISTIC</span> 
<span class="token keyword">BEGIN</span>
<span class="token keyword">DECLARE</span> retval <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> retval<span class="token operator">=</span><span class="token string">&quot;-999999999,null&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span>CAST<span class="token punctuation">(</span>current_value <span class="token keyword">AS</span> <span class="token keyword">CHAR</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">,</span>CAST<span class="token punctuation">(</span>increment <span class="token keyword">AS</span> <span class="token keyword">CHAR</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">INTO</span> retval <span class="token keyword">FROM</span> MYCAT_SEQUENCE <span class="token keyword">WHERE</span> NAME <span class="token operator">=</span> seq_name<span class="token punctuation">;</span>
<span class="token keyword">RETURN</span> retval<span class="token punctuation">;</span>
<span class="token keyword">END</span> $$
<span class="token keyword">DELIMITER</span><span class="token punctuation">;</span>
<span class="token keyword">DELIMITER</span> $$
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> mycat_seq_setval<span class="token punctuation">(</span>seq_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">VALUE</span> <span class="token keyword">INTEGER</span><span class="token punctuation">)</span> <span class="token keyword">RETURNS</span> 
<span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span>
<span class="token keyword">DETERMINISTIC</span>
<span class="token keyword">BEGIN</span>
<span class="token keyword">UPDATE</span> MYCAT_SEQUENCE
<span class="token keyword">SET</span> current_value <span class="token operator">=</span> <span class="token keyword">VALUE</span>
<span class="token keyword">WHERE</span> NAME <span class="token operator">=</span> seq_name<span class="token punctuation">;</span>
<span class="token keyword">RETURN</span> mycat_seq_currval<span class="token punctuation">(</span>seq_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> $$
<span class="token keyword">DELIMITER</span><span class="token punctuation">;</span>
<span class="token keyword">DELIMITER</span> $$
<span class="token keyword">CREATE</span> <span class="token keyword">FUNCTION</span> mycat_seq_nextval<span class="token punctuation">(</span>seq_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">RETURNS</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> 
<span class="token keyword">DETERMINISTIC</span>
<span class="token keyword">BEGIN</span>
<span class="token keyword">UPDATE</span> MYCAT_SEQUENCE
<span class="token keyword">SET</span> current_value <span class="token operator">=</span> current_value <span class="token operator">+</span> increment <span class="token keyword">WHERE</span> NAME <span class="token operator">=</span> seq_name<span class="token punctuation">;</span>
<span class="token keyword">RETURN</span> mycat_seq_currval<span class="token punctuation">(</span>seq_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> $$
<span class="token keyword">DELIMITER</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>åˆå§‹åŒ–åºåˆ—è¡¨è®°å½•</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> MYCAT_SEQUENCE<span class="token punctuation">(</span>NAME<span class="token punctuation">,</span>current_value<span class="token punctuation">,</span>increment<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;ORDERS&#39;</span><span class="token punctuation">,</span> <span class="token number">400000</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol></li><li><p>ä¿®æ”¹<code>MyCat</code>é…ç½®</p><ol><li><p>ä¿®æ”¹<code>sequence_db_conf.properties</code><br> æ„æ€æ˜¯<code>orders</code>è¿™ä¸ªåºåˆ—åœ¨<code>dn1</code>è¿™ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå…·ä½“<code>dn1</code>èŠ‚ç‚¹æ˜¯å“ªå°æœºå­ï¼Œè¯·å‚è€ƒ<code>schema.xml</code></p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># sequence_db_conf.properties</span>
<span class="token key attr-name">GLOBAL</span><span class="token punctuation">=</span><span class="token value attr-value">dn1</span>
<span class="token key attr-name">COMPANY</span><span class="token punctuation">=</span><span class="token value attr-value">dn1</span>
<span class="token key attr-name">CUSTOMER</span><span class="token punctuation">=</span><span class="token value attr-value">dn1</span>
<span class="token key attr-name">ORDERS</span><span class="token punctuation">=</span><span class="token value attr-value">dn1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä¿®æ”¹<code>server.xml</code><br> å…¨å±€åºåˆ—ç±»å‹ï¼š</p><ul><li>0ï¼šæœ¬åœ°æ–‡ä»¶</li><li>1ï¼šæ•°æ®åº“æ–¹å¼</li><li>2ï¼šæ—¶é—´æˆ³æ–¹å¼</li></ul><p>æ­¤å¤„åº”è¯¥ä¿®æ”¹æˆ 1ã€‚</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sequnceHandlerType<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--&lt;property name=&quot;useCompression&quot;&gt;1&lt;/property&gt;--&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>é‡å¯<code>MyCat</code></p></li></ol></li><li><p>éªŒè¯å…¨å±€åºåˆ—</p><ol><li><p>ç™»å½•<code>MyCat</code>ï¼Œæ’å…¥æ•°æ®</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> orders<span class="token punctuation">(</span>id<span class="token punctuation">,</span>amount<span class="token punctuation">,</span>customer_id<span class="token punctuation">,</span>order_type<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token keyword">next</span> <span class="token keyword">value</span> <span class="token keyword">for</span> MYCATSEQ_ORDERS<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>æŸ¥è¯¢æ•°æ®</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> orders<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>é‡å¯<code>MyCat</code>åï¼Œå†æ¬¡æ’å…¥æ•°æ®ï¼Œå†æŸ¥è¯¢</p></li></ol></li></ol></li><li><p>æ—¶é—´æˆ³æ–¹å¼<br> å…¨å±€åºåˆ—<code>ID= 64</code>ä½äºŒè¿›åˆ¶<br> 42ï¼ˆæ¯«ç§’ï¼‰+ 5ï¼ˆæœºå™¨ IDï¼‰+ 5ï¼ˆä¸šåŠ¡ç¼–ç ï¼‰+ 12ï¼ˆé‡å¤ç´¯åŠ ï¼‰æ¢ç®—æˆåè¿›åˆ¶ä¸º 18 ä½æ•°çš„<code>long</code>ç±»å‹ï¼Œæ¯æ¯«ç§’å¯ä»¥å¹¶å‘ 12 ä½äºŒè¿›åˆ¶çš„ç´¯åŠ ã€‚</p><ul><li>ä¼˜ç‚¹ï¼šé…ç½®ç®€å•</li><li>ç¼ºç‚¹ï¼š18 ä½<code>ID</code>è¿‡é•¿</li></ul></li><li><p>è‡ªä¸»ç”Ÿæˆå…¨å±€åºåˆ—<br> å¯åœ¨<code>Java</code>é¡¹ç›®é‡Œè‡ªå·±ç”Ÿæˆå…¨å±€åºåˆ—ï¼Œå¦‚ä¸‹ï¼š</p><ol><li>æ ¹æ®ä¸šåŠ¡é€»è¾‘ç»„åˆ</li><li>å¯ä»¥åˆ©ç”¨<code>Redis</code>çš„å•çº¿ç¨‹åŸå­æ€§<code>incr</code>æ¥ç”Ÿæˆåºåˆ—ï¼Œä½†ï¼Œè‡ªä¸»ç”Ÿæˆéœ€è¦å•ç‹¬åœ¨å·¥ç¨‹ä¸­ç”¨<code>Java</code> ä»£ç å®ç°ï¼Œè¿˜æ˜¯æ¨èä½¿ç”¨<code>MyCat</code>è‡ªå¸¦å…¨å±€åºåˆ—</li></ol></li></ol><h2 id="åŸºäº-ha-æœºåˆ¶çš„-mycat-é«˜å¯ç”¨" tabindex="-1"><a class="header-anchor" href="#åŸºäº-ha-æœºåˆ¶çš„-mycat-é«˜å¯ç”¨" aria-hidden="true">#</a> åŸºäº HA æœºåˆ¶çš„ MyCat é«˜å¯ç”¨</h2><p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œ<code>MyCat</code>æœåŠ¡ä¹Ÿéœ€è¦è€ƒè™‘é«˜å¯ç”¨æ€§ï¼Œå¦‚æœ<code>MyCat</code>æ‰€åœ¨æœåŠ¡å™¨å‡ºç°å®•æœºï¼Œæˆ–<code>MyCat</code>æœ<br>åŠ¡æ•…éšœï¼Œéœ€è¦æœ‰å¤‡æœºæä¾›æœåŠ¡ï¼Œéœ€è¦è€ƒè™‘<code>MyCat</code>é›†ç¾¤ã€‚</p><h3 id="é«˜å¯ç”¨æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#é«˜å¯ç”¨æ–¹æ¡ˆ" aria-hidden="true">#</a> é«˜å¯ç”¨æ–¹æ¡ˆ</h3><p>å¯ä»¥ä½¿ç”¨<code>HAProxy + Keepalived</code>é…åˆä¸¤å°<code>MyCat</code>æ­èµ·<code>MyCat</code>é›†ç¾¤ï¼Œå®ç°é«˜å¯ç”¨æ€§ã€‚<code>HAProxy</code>å®ç°äº†<code>MyCat</code>å¤šèŠ‚ç‚¹çš„é›†ç¾¤é«˜å¯ç”¨å’Œè´Ÿè½½å‡è¡¡ï¼Œè€Œ<code>HAProxy</code>è‡ªèº«çš„é«˜å¯ç”¨åˆ™å¯ä»¥é€šè¿‡<code>Keepalived</code>æ¥å®ç°ã€‚</p><figure><img src="https://cdn.jsdelivr.net/gh/1coins/assets/mycat-summary/mycat-haproxy-keepalived.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><table><thead><tr><th>ç¼–å·</th><th>è§’è‰²</th><th><code>IP</code>åœ°å€</th><th>æœºå™¨å</th></tr></thead><tbody><tr><td>1</td><td>Mycat1</td><td>192.168.140.128</td><td>host79</td></tr><tr><td>2</td><td>Mycat2<br></td><td>192.168.140.127</td><td>host80</td></tr><tr><td>3</td><td>HAProxyï¼ˆmasterï¼‰</td><td>192.168.140.126</td><td>host81</td></tr><tr><td>4</td><td>Keepalivedï¼ˆmasterï¼‰</td><td>192.168.140.126</td><td>host81</td></tr><tr><td>5</td><td>HAProxyï¼ˆbackupï¼‰</td><td>192.168.140.125</td><td>host82</td></tr><tr><td>6</td><td>Keepalivedï¼ˆbackupï¼‰</td><td>192.168.140.125</td><td>host82</td></tr></tbody></table><h3 id="å®‰è£…é…ç½®-haproxy" tabindex="-1"><a class="header-anchor" href="#å®‰è£…é…ç½®-haproxy" aria-hidden="true">#</a> å®‰è£…é…ç½® HAProxy</h3><ol><li>å®‰è£…<code>HAProxy</code><ol><li><p>å‡†å¤‡å¥½<code>HAProxy</code>å®‰è£…åŒ…ï¼Œä¼ åˆ°<code>/opt</code>ç›®å½•ä¸‹</p></li><li><p>è§£å‹åˆ°<code>/usr/local/src</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> haproxy-1.5.18.tar.gz <span class="token parameter variable">-C</span> /usr/local/src
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>è¿›å…¥è§£å‹åçš„ç›®å½•ï¼ŒæŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ï¼Œè¿›è¡Œç¼–è¯‘</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/src/haproxy-1.5.18
<span class="token function">uname</span> <span class="token parameter variable">-r</span>
<span class="token function">make</span> <span class="token assign-left variable">TARGET</span><span class="token operator">=</span>linux310 <span class="token assign-left variable">PREFIX</span><span class="token operator">=</span>/usr/local/haproxy <span class="token assign-left variable">ARCH</span><span class="token operator">=</span>x86_64
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>ARGET=linux310</code>ï¼šå†…æ ¸ç‰ˆæœ¬ï¼Œä½¿ç”¨<code>uname -r</code>æŸ¥çœ‹å†…æ ¸ï¼Œå¦‚ï¼š<code>3.10.0-514.el7</code>ï¼Œæ­¤æ—¶è¯¥å‚æ•°å°±ä¸º<code>linux310</code></li><li><code>ARCH=x86_64</code>ï¼šç³»ç»Ÿä½æ•°</li><li><code>PREFIX=/usr/local/haprpxy</code>ï¼š<code>/usr/local/haprpxy</code>ï¼Œä¸º<code>HAPrpxy</code>å®‰è£…è·¯å¾„</li></ul></li><li><p>ç¼–è¯‘å®Œæˆåï¼Œè¿›è¡Œå®‰è£…</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">make</span> <span class="token function">install</span> <span class="token assign-left variable">PREFIX</span><span class="token operator">=</span>/usr/local/haproxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å®‰è£…å®Œæˆåï¼Œåˆ›å»ºç›®å½•ã€åˆ›å»º<code>HAProxy</code>é…ç½®æ–‡ä»¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/data/haproxy/
<span class="token function">vim</span> /usr/local/haproxy/haproxy.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>å‘é…ç½®æ–‡ä»¶ä¸­æ’å…¥ä»¥ä¸‹é…ç½®ä¿¡æ¯,å¹¶ä¿å­˜</p><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code>global
    log 127.0.0.1 local0
    #log 127.0.0.1 local1 notice
    #log loghost local0 info
    maxconn 4096
    chroot /usr/local/haproxy
    pidfile /usr/data/haproxy/haproxy.pid
    uid 99
    gid 99
    daemon
    #debug
    #quiet
defaults
    log global
    mode tcp
    option abortonclose
    option redispatch
    retries 3
    maxconn 2000
    timeout connect 5000
    timeout client 50000
    timeout server 50000
listen proxy_status 
    bind :48066
        mode tcp
        balance roundrobin
        server mycat_1 192.168.140.128:8066 check inter 10s
        server mycat_2 192.168.140.127:8066 check inter 10s
frontend admin_stats 
    bind :7777
        mode http
        stats enable
        option httplog
        maxconn 10
        stats refresh 30s
        stats uri /admin
        stats auth admin:123123
        stats hide-version
        stats admin if TRUE
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></li><li>å¯åŠ¨éªŒè¯ <ol><li>å¯åŠ¨<code>HAProxy</code><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/haproxy/sbin/haproxy <span class="token parameter variable">-f</span> /usr/local/haproxy/haproxy.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>æŸ¥çœ‹<code>HAProxy</code>è¿›ç¨‹<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">ps</span> -ef<span class="token operator">|</span><span class="token function">grep</span> haproxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>æ‰“å¼€æµè§ˆå™¨è®¿é—®<code>http://192.168.140.125:7777/admin</code><ul><li>åœ¨å¼¹å‡ºæ¡†è¾“å…¥ç”¨æˆ·åï¼š<code>admin</code>å¯†ç ï¼š<code>123456</code></li><li>å¦‚æœ<code>MyCat</code>ä¸»å¤‡æœºå‡å·²å¯åŠ¨ï¼Œåˆ™å¯ä»¥çœ‹åˆ°å¦‚ä¸‹å›¾ï¼ˆ<code>MyCat1</code>å’Œ<code>MyCat2</code>å…¨ç»¿ï¼‰</li></ul></li><li>éªŒè¯è´Ÿè½½å‡è¡¡ï¼Œé€šè¿‡<code>HAProxy</code>è®¿é—®<code>MyCat</code><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-umycat</span> <span class="token parameter variable">-p123456</span> <span class="token parameter variable">-h</span> <span class="token number">192.168</span>.140.126 <span class="token parameter variable">-P</span> <span class="token number">48066</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol></li></ol><h3 id="é…ç½®-keepalived" tabindex="-1"><a class="header-anchor" href="#é…ç½®-keepalived" aria-hidden="true">#</a> é…ç½® Keepalived</h3><ol><li>å®‰è£…<code>Keepalived</code><ol><li><p>å‡†å¤‡å¥½<code>Keepalived</code>å®‰è£…åŒ…ï¼Œä¼ åˆ°<code>/opt</code>ç›®å½•ä¸‹</p></li><li><p>è§£å‹åˆ°<code>/usr/local/src</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> keepalived-1.4.2.tar.gz <span class="token parameter variable">-C</span> /usr/local/src
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>å®‰è£…ä¾èµ–æ’ä»¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> <span class="token parameter variable">-y</span> gcc openssl-devel popt-devel
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>è¿›å…¥è§£å‹åçš„ç›®å½•ï¼Œè¿›è¡Œé…ç½®ï¼Œè¿›è¡Œç¼–è¯‘</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/src/keepalived-1.4.2
./configure <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/usr/local/keepalived
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>è¿›è¡Œç¼–è¯‘ï¼Œå®Œæˆåè¿›è¡Œå®‰è£…</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>è¿è¡Œå‰é…ç½®</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cp</span> /usr/local/src/keepalived-1.4.2/keepalived/etc/init.d/keepalived /etc/init.d/
<span class="token function">mkdir</span> /etc/keepalived
<span class="token function">cp</span> /usr/local/keepalived/etc/keepalived/keepalived.conf /etc/keepalived/
<span class="token function">cp</span> /usr/local/src/keepalived-1.4.2/keepalived/etc/sysconfig/keepalived /etc/sysconfig/
<span class="token function">cp</span> /usr/local/keepalived/sbin/keepalived /usr/sbin/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> /etc/keepalived/keepalived.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-conf line-numbers-mode" data-ext="conf"><pre class="language-conf"><code># ä¿®æ”¹å†…å®¹å¦‚ä¸‹
! Configuration File for keepalived
global_defs {
    notification_email {
        xlcocoon@foxmail.com
    }
    notification_email_from keepalived@showjoy.com
    smtp_server 127.0.0.1
    smtp_connect_timeout 30
    router_id LVS_DEVEL
    vrrp_skip_check_adv_addr
    vrrp_garp_interval 0
    vrrp_gna_interval 0
}
vrrp_instance VI_1 {
    # ä¸»æœºé… MASTERï¼Œå¤‡æœºé… BACKUP
    state MASTER
    # æ‰€åœ¨æœºå™¨ç½‘å¡
    interface ens33
    virtual_router_id 51
    # æ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜
    priority 100
    advert_int 1
    authentication {
        auth_type PASS
        auth_pass 1111
    }
    virtual_ipaddress {
        # è™šæ‹Ÿ IP
        192.168.140.200
    }
}
virtual_server 192.168.140.200 48066 {
    delay_loop 6
    lb_algo rr
    lb_kind NAT
    persistence_timeout 50
    protocol TCP
    real_server 192.168.140.125 48066 {
        weight 1
        TCP_CHECK {
            connect_timeout 3
            retry 3
            delay_before_retry 3
        }
    }
    real_server 192.168.140.126 48600 {
        weight 1
        TCP_CHECK {
            connect_timeout 3
            nb_get_retry 3
            delay_before_retry 3
        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></li><li>å¯åŠ¨éªŒè¯ <ol><li>å¯åŠ¨<code>Keepalived</code><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">service</span> keepalived start
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>ç™»å½•éªŒè¯<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-umycat</span> <span class="token parameter variable">-p123456</span> <span class="token parameter variable">-h</span> <span class="token number">192.168</span>.140.200 <span class="token parameter variable">-P</span> <span class="token number">48066</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol></li></ol><h3 id="æµ‹è¯•é«˜å¯ç”¨" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•é«˜å¯ç”¨" aria-hidden="true">#</a> æµ‹è¯•é«˜å¯ç”¨</h3><ol><li>å…³é—­<code>MyCat</code></li><li>é€šè¿‡è™šæ‹Ÿ<code>IP</code>æŸ¥è¯¢æ•°æ®<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-umycat</span> <span class="token parameter variable">-p123456</span> <span class="token parameter variable">-h</span> <span class="token number">192.168</span>.140.200 <span class="token parameter variable">-P</span> <span class="token number">48066</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h1 id="mycat-å®‰å…¨è®¾ç½®" tabindex="-1"><a class="header-anchor" href="#mycat-å®‰å…¨è®¾ç½®" aria-hidden="true">#</a> MyCat å®‰å…¨è®¾ç½®</h1><h2 id="æƒé™é…ç½®" tabindex="-1"><a class="header-anchor" href="#æƒé™é…ç½®" aria-hidden="true">#</a> æƒé™é…ç½®</h2><h3 id="user-æ ‡ç­¾æƒé™æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#user-æ ‡ç­¾æƒé™æ§åˆ¶" aria-hidden="true">#</a> user æ ‡ç­¾æƒé™æ§åˆ¶</h3><p>ç›®å‰<code>MyCat</code>å¯¹äºä¸­é—´ä»¶çš„è¿æ¥æ§åˆ¶å¹¶æ²¡æœ‰åšå¤ªå¤æ‚çš„æ§åˆ¶ï¼Œç›®å‰åªåšäº†ä¸­é—´ä»¶é€»è¾‘åº“çº§åˆ«çš„è¯»<br>å†™æƒé™æ§åˆ¶ã€‚æ˜¯é€šè¿‡<code>server.xml</code>çš„<code>user</code>æ ‡ç­¾è¿›è¡Œé…ç½®ã€‚</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- server.xml é…ç½®æ–‡ä»¶ user éƒ¨åˆ† --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mycat<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>schemas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>TESTDB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>user<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>schemas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>TESTDB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>readOnly<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é…ç½®è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#é…ç½®è¯´æ˜" aria-hidden="true">#</a> é…ç½®è¯´æ˜</h4><table><thead><tr><th>æ ‡ç­¾å±æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>name</code></td><td>åº”ç”¨è¿æ¥ä¸­é—´ä»¶é€»è¾‘åº“çš„ç”¨æˆ·å</td></tr><tr><td><code>password</code></td><td>è¯¥ç”¨æˆ·å¯¹åº”çš„å¯†ç </td></tr><tr><td><code>TESTDB</code></td><td>åº”ç”¨å½“å‰è¿æ¥çš„é€»è¾‘åº“ä¸­æ‰€å¯¹åº”çš„é€»è¾‘è¡¨ï¼Œ<code>schemas</code>ä¸­å¯ä»¥é…ç½®ä¸€ä¸ªæˆ–å¤šä¸ª</td></tr><tr><td><code>readOnly</code></td><td>åº”ç”¨è¿æ¥ä¸­é—´ä»¶é€»è¾‘åº“æ‰€å…·æœ‰çš„æƒé™<br><code>true</code>ä¸ºåªè¯»ï¼Œ<code>false</code>ä¸ºè¯»å†™éƒ½æœ‰ï¼Œé»˜è®¤ä¸º<code>false</code><br></td></tr></tbody></table><h4 id="æµ‹è¯•æ¡ˆä¾‹ä¸€" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•æ¡ˆä¾‹ä¸€" aria-hidden="true">#</a> æµ‹è¯•æ¡ˆä¾‹ä¸€</h4><p>ä½¿ç”¨<code>user</code>ç”¨æˆ·ï¼Œæƒé™ä¸ºåªè¯»ï¼ˆ<code>readOnlyï¼štrue</code>ï¼‰ï¼ŒéªŒè¯æ˜¯å¦å¯ä»¥æŸ¥è¯¢å‡ºæ•°æ®ï¼ŒéªŒè¯æ˜¯å¦å¯ä»¥å†™å…¥æ•°æ®ã€‚</p><ol><li>ç”¨<code>user</code>ç”¨æˆ·ç™»å½•<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-uuser</span> <span class="token parameter variable">-puser</span> <span class="token parameter variable">-h</span> <span class="token number">192.168</span>.140.128 <span class="token parameter variable">-P8066</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>åˆ‡æ¢åˆ°<code>TESTDB</code>æ•°æ®åº“ï¼ŒæŸ¥è¯¢<code>orders</code>è¡¨æ•°æ®<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">use</span> TESTDB
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> orders<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li>æ‰§è¡Œæ’å…¥æ•°æ®<code>sql</code>ï¼Œå¯çœ‹åˆ°è¿è¡Œç»“æœï¼Œæ’å…¥å¤±è´¥ï¼Œåªæœ‰åªè¯»æƒé™<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> orders<span class="token punctuation">(</span>id<span class="token punctuation">,</span>order_type<span class="token punctuation">,</span>customer_id<span class="token punctuation">,</span>amount<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h4 id="æµ‹è¯•æ¡ˆä¾‹äºŒ" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•æ¡ˆä¾‹äºŒ" aria-hidden="true">#</a> æµ‹è¯•æ¡ˆä¾‹äºŒ</h4><p>ä½¿ç”¨<code>mycat</code>ç”¨æˆ·ï¼Œæƒé™ä¸ºå¯è¯»å†™ï¼ˆ<code>readOnlyï¼šfalse</code>ï¼‰ï¼ŒéªŒè¯æ˜¯å¦å¯ä»¥æŸ¥è¯¢å‡ºæ•°æ®ï¼ŒéªŒè¯æ˜¯å¦å¯ä»¥å†™å…¥æ•°æ®ã€‚</p><ol><li>ç”¨<code>mycat</code>ç”¨æˆ·ç™»å½•<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-umycat</span> <span class="token parameter variable">-p123456</span> <span class="token parameter variable">-h</span> <span class="token number">192.168</span>.140.128 <span class="token parameter variable">-P8066</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>åˆ‡æ¢åˆ°<code>TESTDB</code>æ•°æ®åº“ï¼ŒæŸ¥è¯¢<code>orders</code>è¡¨æ•°æ®<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">use</span> TESTDB
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> orders<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li>æ‰§è¡Œæ’å…¥æ•°æ®<code>sql</code>ï¼Œå¯çœ‹åˆ°è¿è¡Œç»“æœï¼Œæ’å…¥æˆåŠŸ<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> orders<span class="token punctuation">(</span>id<span class="token punctuation">,</span>order_type<span class="token punctuation">,</span>customer_id<span class="token punctuation">,</span>amount<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h3 id="privileges-æ ‡ç­¾æƒé™æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#privileges-æ ‡ç­¾æƒé™æ§åˆ¶" aria-hidden="true">#</a> privileges æ ‡ç­¾æƒé™æ§åˆ¶</h3><p>åœ¨<code>user</code>æ ‡ç­¾ä¸‹çš„<code>privileges</code>æ ‡ç­¾å¯ä»¥å¯¹é€»è¾‘åº“ï¼ˆ<code>schema</code>ï¼‰ã€è¡¨ï¼ˆ<code>table</code>ï¼‰è¿›è¡Œç²¾ç»†åŒ–çš„<code>DML</code>æƒé™æ§åˆ¶ã€‚<br><code>privileges</code>æ ‡ç­¾ä¸‹çš„<code>check</code>å±æ€§ï¼Œå¦‚ä¸º<code>true</code>å¼€å¯æƒé™æ£€æŸ¥ï¼Œä¸º<code>false</code>ä¸å¼€å¯ï¼Œé»˜è®¤ä¸º<code>false</code>ã€‚</p><p>ç”±äº<code>Mycat</code>ä¸€ä¸ªç”¨æˆ·çš„<code>schemas</code>å±æ€§å¯é…ç½®å¤šä¸ªé€»è¾‘åº“ï¼ˆ<code>schema</code>ï¼‰ ï¼Œæ‰€ä»¥<code>privileges</code>çš„ä¸‹çº§èŠ‚ç‚¹<code>schema</code>èŠ‚ç‚¹åŒæ ·å¯é…ç½®å¤šä¸ªï¼Œå¯¹å¤šåº“å¤šè¡¨è¿›è¡Œç»†ç²’åº¦çš„<code>DML</code>æƒé™æ§åˆ¶ã€‚</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- server.xml é…ç½®æ–‡ä»¶ privileges éƒ¨åˆ† --&gt;</span>
<span class="token comment">&lt;!-- é…ç½® orders è¡¨æ²¡æœ‰å¢åˆ æ”¹æŸ¥æƒé™ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mycat<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>schemas<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>TESTDB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- è¡¨çº§ DML æƒé™è®¾ç½® --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>privileges</span> <span class="token attr-name">check</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>schema</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>TESTDB<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dml</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1111<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>orders<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dml</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0000<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--&lt;table name=&quot;tb02&quot; dml=&quot;1111&quot;&gt;&lt;/table&gt;--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>schema</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>privileges</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="é…ç½®è¯´æ˜-1" tabindex="-1"><a class="header-anchor" href="#é…ç½®è¯´æ˜-1" aria-hidden="true">#</a> é…ç½®è¯´æ˜</h4><table><thead><tr><th><code>DML</code>æƒé™</th><th>å¢åŠ ï¼ˆ<code>insert</code>ï¼‰</th><th>æ›´æ–°ï¼ˆ<code>update</code>ï¼‰</th><th>æŸ¥è¯¢ï¼ˆ<code>select</code>ï¼‰</th><th>åˆ é™¤ï¼ˆ<code>delete</code>ï¼‰</th></tr></thead><tbody><tr><td>0000</td><td>ç¦æ­¢</td><td>ç¦æ­¢</td><td>ç¦æ­¢</td><td>ç¦æ­¢</td></tr><tr><td>0010</td><td>ç¦æ­¢<br></td><td>ç¦æ­¢</td><td>å¯ä»¥</td><td>ç¦æ­¢</td></tr><tr><td>1110</td><td>å¯ä»¥</td><td>ç¦æ­¢</td><td>ç¦æ­¢</td><td>ç¦æ­¢</td></tr><tr><td>1111</td><td>å¯ä»¥</td><td>å¯ä»¥</td><td>å¯ä»¥</td><td>å¯ä»¥</td></tr></tbody></table><h4 id="æµ‹è¯•æ¡ˆä¾‹ä¸€-1" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•æ¡ˆä¾‹ä¸€-1" aria-hidden="true">#</a> æµ‹è¯•æ¡ˆä¾‹ä¸€</h4><p>ä½¿ç”¨<code>mycat</code>ç”¨æˆ·ï¼Œ<code>privileges</code>é…ç½®<code>orders</code>è¡¨æƒé™ä¸ºç¦æ­¢å¢åˆ æ”¹æŸ¥ï¼ˆ<code>dml=&quot;0000&quot;</code>ï¼‰ï¼ŒéªŒè¯æ˜¯å¦å¯ä»¥æŸ¥è¯¢å‡ºæ•°æ®ï¼ŒéªŒè¯æ˜¯å¦å¯ä»¥å†™å…¥æ•°æ®ã€‚</p><ol><li>é‡å¯<code>MyCat</code>ï¼Œç”¨<code>mycat</code>ç”¨æˆ·ç™»å½•<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-umycat</span> <span class="token parameter variable">-p123456</span> <span class="token parameter variable">-h</span> <span class="token number">192.168</span>.140.128 <span class="token parameter variable">-P8066</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>åˆ‡æ¢åˆ°<code>TESTDB</code>æ•°æ®åº“ï¼ŒæŸ¥è¯¢<code>orders</code>è¡¨æ•°æ®ï¼Œå‘ç°ç¦æ­¢è¯¥ç”¨æˆ·æŸ¥è¯¢æ•°æ®<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">use</span> TESTDB
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> orders<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li>æ‰§è¡Œæ’å…¥æ•°æ®<code>sql</code>ï¼Œå¯çœ‹åˆ°è¿è¡Œç»“æœï¼Œç¦æ­¢è¯¥ç”¨æˆ·æ’å…¥æ•°æ®<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> orders<span class="token punctuation">(</span>id<span class="token punctuation">,</span>order_type<span class="token punctuation">,</span>customer_id<span class="token punctuation">,</span>amount<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h4 id="æµ‹è¯•æ¡ˆä¾‹äºŒ-1" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•æ¡ˆä¾‹äºŒ-1" aria-hidden="true">#</a> æµ‹è¯•æ¡ˆä¾‹äºŒ</h4><p>ä½¿ç”¨<code>mycat</code>ç”¨æˆ·ï¼Œ<code>privileges</code>é…ç½®<code>orders</code>è¡¨æƒé™ä¸ºå¯ä»¥å¢åˆ æ”¹æŸ¥ï¼ˆ<code>dml=&quot;1111&quot;</code>ï¼‰ï¼ŒéªŒè¯æ˜¯å¦å¯ä»¥æŸ¥è¯¢å‡ºæ•°æ®ï¼ŒéªŒè¯æ˜¯å¦å¯ä»¥å†™å…¥æ•°æ®ã€‚</p><ol><li>é‡å¯<code>MyCat</code>ï¼Œç”¨<code>mycat</code>ç”¨æˆ·ç™»å½•<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-umycat</span> <span class="token parameter variable">-p123456</span> <span class="token parameter variable">-h</span> <span class="token number">192.168</span>.140.128 <span class="token parameter variable">-P8066</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>åˆ‡æ¢åˆ°<code>TESTDB</code>æ•°æ®åº“ï¼ŒæŸ¥è¯¢<code>orders</code>è¡¨æ•°æ®<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">use</span> TESTDB
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> orders<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li>æ‰§è¡Œæ’å…¥æ•°æ®<code>sql</code>ï¼Œå¯çœ‹åˆ°è¿è¡Œç»“æœï¼Œæ’å…¥æˆåŠŸ<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span> orders<span class="token punctuation">(</span>id<span class="token punctuation">,</span>order_type<span class="token punctuation">,</span>customer_id<span class="token punctuation">,</span>amount<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>æ‰§è¡Œåˆ é™¤æ•°æ®<code>sql</code>ï¼Œå¯çœ‹åˆ°è¿è¡Œç»“æœï¼Œåˆ é™¤æˆåŠŸ<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">delete</span> <span class="token keyword">from</span> orders <span class="token keyword">where</span> id <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h2 id="sql-æ‹¦æˆª" tabindex="-1"><a class="header-anchor" href="#sql-æ‹¦æˆª" aria-hidden="true">#</a> SQL æ‹¦æˆª</h2><p><code>firewall</code>æ ‡ç­¾ç”¨æ¥å®šä¹‰é˜²ç«å¢™ï¼›<code>firewall</code>ä¸‹<code>whitehost</code>æ ‡ç­¾ç”¨æ¥å®šä¹‰<code>IP</code>ç™½åå•ï¼Œ<code>blacklist</code>ç”¨æ¥å®šä¹‰<code>SQL</code>é»‘åå•ã€‚</p><h3 id="ç™½åå•" tabindex="-1"><a class="header-anchor" href="#ç™½åå•" aria-hidden="true">#</a> ç™½åå•</h3><p>å¯ä»¥é€šè¿‡è®¾ç½®ç™½åå•ï¼Œå®ç°æŸä¸»æœºæŸç”¨æˆ·å¯ä»¥è®¿é—®<code>MyCat</code>ï¼Œè€Œå…¶ä»–ä¸»æœºç”¨æˆ·ç¦æ­¢è®¿é—®ã€‚</p><ol><li>è®¾ç½®ç™½åå•<div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- server.xml é…ç½®æ–‡ä»¶ firewall æ ‡ç­¾ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>~--</span> <span class="token attr-name">é…ç½®åªæœ‰</span> <span class="token attr-name">192.168.140.128</span> <span class="token attr-name">ä¸»æœºå¯ä»¥é€šè¿‡</span> <span class="token attr-name">mycat</span> <span class="token attr-name">ç”¨æˆ·è®¿é—®</span> <span class="token attr-name">--</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>firewall</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>whitehost</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.140.128<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mycat<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>whitehost</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>firewall</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>é‡å¯<code>MyCat</code>åï¼Œ<code>192.168.140.128</code>ä¸»æœºä½¿ç”¨<code>mycat</code>ç”¨æˆ·è®¿é—®ï¼Œå¯ä»¥æ­£å¸¸è®¿é—®ï¼Œä½¿ç”¨<code>user</code>ç”¨æˆ·è®¿é—®ï¼Œç¦æ­¢è®¿é—®ï¼›åœ¨<code>192.168.140.127</code>ä¸»æœºç”¨<code>mycat</code>ç”¨æˆ·è®¿é—®ï¼Œç¦æ­¢è®¿é—®<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-umycat</span> <span class="token parameter variable">-p123456</span> <span class="token parameter variable">-h</span> <span class="token number">192.168</span>.140.128 <span class="token parameter variable">-P</span> <span class="token number">8066</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><h3 id="é»‘åå•" tabindex="-1"><a class="header-anchor" href="#é»‘åå•" aria-hidden="true">#</a> é»‘åå•</h3><p>å¯ä»¥é€šè¿‡è®¾ç½®é»‘åå•ï¼Œå®ç°<code>MyCat</code>å¯¹å…·ä½“<code>SQL</code>æ“ä½œçš„æ‹¦æˆªï¼Œå¦‚å¢åˆ æ”¹æŸ¥ç­‰æ“ä½œçš„æ‹¦æˆªã€‚</p><ol><li>è®¾ç½®é»‘åå•<div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!-- server.xml é…ç½®æ–‡ä»¶ firewall æ ‡ç­¾ --&gt;</span>
<span class="token comment">&lt;!-- é…ç½®ç¦æ­¢ mycat ç”¨æˆ·è¿›è¡Œåˆ é™¤æ“ä½œ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>firewall</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>whitehost</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>host</span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>192.168.140.128<span class="token punctuation">&quot;</span></span> <span class="token attr-name">user</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mycat<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>whitehost</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>blacklist</span> <span class="token attr-name">check</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>deleteAllow<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>blacklist</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>firewall</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li>é‡å¯<code>MyCat</code>åï¼Œ<code>192.168.140.128</code>ä¸»æœºä½¿ç”¨<code>mycat</code>ç”¨æˆ·è®¿é—®ï¼Œå¯ä»¥æ­£å¸¸è®¿é—®<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-umycat</span> <span class="token parameter variable">-p123456</span> <span class="token parameter variable">-h</span> <span class="token number">192.168</span>.140.128 <span class="token parameter variable">-P</span> <span class="token number">8066</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>åˆ‡æ¢<code>TESTDB</code>æ•°æ®åº“åï¼Œæ‰§è¡Œåˆ é™¤æ•°æ®è¯­å¥ï¼Œå‘ç°å·²ç¦æ­¢åˆ é™¤æ•°æ®<div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">delete</span> <span class="token keyword">from</span> orders <span class="token keyword">where</span> id<span class="token operator">=</span><span class="token number">7</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol><p>å¯ä»¥è®¾ç½®çš„é»‘åå•<code>SQL</code>æ‹¦æˆªåŠŸèƒ½åˆ—è¡¨ï¼š</p><table><thead><tr><th>é…ç½®é¡¹</th><th>ç¼ºçœå€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>selelctAllow</code></td><td><code>true</code></td><td>æ˜¯å¦å…è®¸æ‰§è¡Œ<code>SELECT</code>è¯­å¥</td></tr><tr><td><code>deleteAllow</code></td><td><code>true</code></td><td>æ˜¯å¦å…è®¸æ‰§è¡Œ<code>DELETE</code>è¯­å¥</td></tr><tr><td><code>updateAllow</code></td><td><code>true</code></td><td>æ˜¯å¦å…è®¸æ‰§è¡Œ<code>UPDATE</code>è¯­å¥</td></tr><tr><td><code>insertAllow</code></td><td><code>true</code><br></td><td>æ˜¯å¦å…è®¸æ‰§è¡Œ<code>INSERT</code>è¯­å¥</td></tr><tr><td><code>createTableAllow</code></td><td><code>true</code></td><td>æ˜¯å¦å…è®¸åˆ›å»ºè¡¨</td></tr><tr><td><code>setAllow</code></td><td><code>true</code></td><td>æ˜¯å¦å…è®¸ä½¿ç”¨<code>SET</code>è¯­æ³•</td></tr><tr><td><code>alterTableAllow</code></td><td><code>true</code></td><td>æ˜¯å¦å…è®¸æ‰§è¡Œ<code>Alter Table</code>è¯­å¥</td></tr><tr><td><code>dropTableAllow</code></td><td><code>true</code></td><td>æ˜¯å¦å…è®¸ä¿®æ”¹è¡¨</td></tr><tr><td><code>commitAllow</code></td><td><code>true</code></td><td>æ˜¯å¦å…è®¸æ‰§è¡Œ<code>commit</code>æ“ä½œ</td></tr><tr><td><code>rollbackAllow</code></td><td><code>true</code></td><td>æ˜¯å¦å…è®¸æ‰§è¡Œ<code>roll back</code>æ“ä½œ</td></tr></tbody></table><h1 id="mycat-ç›‘æ§å·¥å…·" tabindex="-1"><a class="header-anchor" href="#mycat-ç›‘æ§å·¥å…·" aria-hidden="true">#</a> MyCat ç›‘æ§å·¥å…·</h1><h2 id="mycat-web-ç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#mycat-web-ç®€ä»‹" aria-hidden="true">#</a> MyCat-Web ç®€ä»‹</h2><p><code>Mycat-Web</code>æ˜¯<code>MyCat</code>å¯è§†åŒ–è¿ç»´çš„ç®¡ç†å’Œç›‘æ§å¹³å°ï¼Œå¼¥è¡¥äº†<code>MyCat</code>åœ¨ç›‘æ§ä¸Šçš„ç©ºç™½ã€‚å¸®<code>MyCat</code>åˆ†<br>æ‹…ç»Ÿè®¡ä»»åŠ¡å’Œé…ç½®ç®¡ç†ä»»åŠ¡ã€‚<code>Mycat-Web</code>å¼•å…¥äº†<code>ZooKeeper</code>ä½œä¸ºé…ç½®ä¸­å¿ƒï¼Œå¯ä»¥ç®¡ç†å¤šä¸ªèŠ‚ç‚¹ã€‚</p><p><code>Mycat-Ceb</code>ä¸»è¦ç®¡ç†å’Œç›‘æ§<code>MyCat</code>çš„æµé‡ã€è¿æ¥ã€æ´»åŠ¨çº¿ç¨‹å’Œå†…å­˜ç­‰ï¼Œå…·å¤‡<code>IP</code>ç™½åå•ã€é‚®ä»¶å‘Šè­¦ç­‰æ¨¡å—ï¼Œè¿˜å¯ä»¥ç»Ÿè®¡<code>SQL</code>å¹¶åˆ†ææ…¢<code>SQL</code>å’Œé«˜é¢‘<code>SQL</code>ç­‰ã€‚ä¸ºä¼˜åŒ–<code>SQL</code>æä¾›ä¾æ®ã€‚</p><figure><img src="https://cdn.jsdelivr.net/gh/1coins/assets/mycat-summary/mycat-web.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="mycat-web-é…ç½®ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#mycat-web-é…ç½®ä½¿ç”¨" aria-hidden="true">#</a> MyCat-Web é…ç½®ä½¿ç”¨</h2><ol><li><code>ZooKeeper</code>å®‰è£… <ol><li><a href="http://zookeeper.apache.org/" target="_blank" rel="noopener noreferrer">ä¸‹è½½å®‰è£…åŒ…<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>å®‰è£…åŒ…æ‹·è´åˆ°<code>Linux</code>ç³»ç»Ÿ<code>/opt</code>ç›®å½•ä¸‹ï¼Œå¹¶è§£å‹<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> zookeeper-3.4.11.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>è¿›å…¥<code>ZooKeeper</code>è§£å‹åçš„é…ç½®ç›®å½•ï¼ˆ<code>conf</code>ï¼‰ï¼Œå¤åˆ¶é…ç½®æ–‡ä»¶å¹¶æ”¹å<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cp</span> zoo_sample.cfg zoo.cfg
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>è¿›å…¥<code>ZooKeeper</code>çš„å‘½ä»¤ç›®å½•ï¼ˆ<code>bin</code>ï¼‰ï¼Œè¿è¡Œå¯åŠ¨å‘½ä»¤<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>./zkServer.sh start
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><code>ZooKeeper</code>æœåŠ¡ç«¯å£ä¸º <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2181</mn></mrow><annotation encoding="application/x-tex">2181</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2181</span></span></span></span>ï¼ŒæŸ¥çœ‹æœåŠ¡å·²ç»å¯åŠ¨<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">netstat</span> <span class="token parameter variable">-ant</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">2181</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li></ol></li><li><code>MyCat-Web</code>å®‰è£… <ol><li><a href="http://www.mycat.io" target="_blank" rel="noopener noreferrer">ä¸‹è½½å®‰è£…åŒ…<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>å®‰è£…åŒ…æ‹·è´åˆ°<code>Linux</code>ç³»ç»Ÿ<code>/opt</code>ç›®å½•ä¸‹ï¼Œå¹¶è§£å‹<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">tar</span> <span class="token parameter variable">-zxvf</span> Mycat-web-1.0-SNAPSHOT-20170102153329-linux.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>æ‹·è´<code>mycat-web</code>æ–‡ä»¶å¤¹åˆ°<code>/usr/local</code>ç›®å½•ä¸‹<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cp</span> <span class="token parameter variable">-r</span> mycat-web /usr/local
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>è¿›å…¥<code>mycat-web</code>çš„ç›®å½•ä¸‹è¿è¡Œå¯åŠ¨å‘½ä»¤<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /usr/local/mycat-web/
./start.sh <span class="token operator">&amp;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><code>MyCat-Web</code>æœåŠ¡ç«¯å£ä¸º 8082ï¼ŒæŸ¥çœ‹æœåŠ¡å·²ç»å¯åŠ¨<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">netstat</span> <span class="token parameter variable">-ant</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">8082</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li>é€šè¿‡åœ°å€è®¿é—®æœåŠ¡<code>http://192.168.140.127:8082/mycat/</code></li></ol></li><li><code>MyCat-Web</code>é…ç½® <ol><li>åœ¨æ³¨å†Œä¸­å¿ƒé…ç½®<code>ZooKeeper</code>åœ°å€ï¼Œé…ç½®ååˆ·æ–°é¡µé¢</li><li>æ–°å¢<code>MyCat</code>ç›‘æ§å®ä¾‹</li></ol></li></ol><h2 id="mycat-æ€§èƒ½ç›‘æ§æŒ‡æ ‡" tabindex="-1"><a class="header-anchor" href="#mycat-æ€§èƒ½ç›‘æ§æŒ‡æ ‡" aria-hidden="true">#</a> Mycat æ€§èƒ½ç›‘æ§æŒ‡æ ‡</h2><p>åœ¨<code>Mycat-web</code>ä¸Šå¯ä»¥è¿›è¡Œ<code>Mycat</code>æ€§èƒ½ç›‘æ§ï¼Œä¾‹å¦‚ï¼šå†…å­˜åˆ†äº«ã€æµé‡åˆ†æã€è¿æ¥åˆ†æã€æ´»åŠ¨çº¿ç¨‹åˆ†æç­‰ç­‰ã€‚</p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: lau5464@126.com">1coins</span><!--]--><!--]--></div></div></footer><!----><div id="comment" class="waline-wrapper" darkmode="false" style="display:block;"><div data-waline provider="Waline"><div class="wl-reaction"><div class="wl-reaction-title">ä½ è®¤ä¸ºè¿™ç¯‡æ–‡ç« æ€ä¹ˆæ ·ï¼Ÿ</div><ul class="wl-reaction-list"><!--[--><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_agree.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_look_down.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_sunglasses.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_pick_nose.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_awkward.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><li class="wl-reaction-item"><div class="wl-reaction-img"><img src="//unpkg.com/@waline/emojis/tieba/tieba_sleep.png"><div class="wl-reaction-votes">0</div></div><div class="wl-reaction-text"></div></li><!--]--></ul></div><div class="wl-comment"><!--v-if--><div class="wl-panel"><div class="wl-header item3"><!--[--><div class="wl-header-item"><label for="wl-nick">æ˜µç§°</label><input id="wl-nick" class="wl-input wl-nick" name="nick" type="text" value></div><div class="wl-header-item"><label for="wl-mail">é‚®ç®±</label><input id="wl-mail" class="wl-input wl-mail" name="mail" type="email" value></div><div class="wl-header-item"><label for="wl-link">ç½‘å€</label><input id="wl-link" class="wl-input wl-link" name="link" type="text" value></div><!--]--></div><textarea id="wl-edit" class="wl-editor" placeholder="è¯·ç•™è¨€ã€‚(å¡«å†™é‚®ç®±å¯åœ¨è¢«å›å¤æ—¶æ”¶åˆ°é‚®ä»¶æé†’)"></textarea><div class="wl-preview" style="display:none;"><hr><h4>é¢„è§ˆ:</h4><div class="wl-content"></div></div><div class="wl-footer"><div class="wl-actions"><a href="https://guides.github.com/features/mastering-markdown/" title="Markdown Guide" aria-label="Markdown is supported" class="wl-action" target="_blank" rel="noopener noreferrer"><svg width="16" height="16" ariaHidden="true"><path d="M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15 13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4 8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z" fill="currentColor"></path></svg></a><button type="button" class="wl-action" title="è¡¨æƒ…" style="display:none;"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M563.2 463.3 677 540c1.7 1.2 3.7 1.8 5.8 1.8.7 0 1.4-.1 2-.2 2.7-.5 5.1-2.1 6.6-4.4l25.3-37.8c1.5-2.3 2.1-5.1 1.6-7.8s-2.1-5.1-4.4-6.6l-73.6-49.1 73.6-49.1c2.3-1.5 3.9-3.9 4.4-6.6.5-2.7 0-5.5-1.6-7.8l-25.3-37.8a10.1 10.1 0 0 0-6.6-4.4c-.7-.1-1.3-.2-2-.2-2.1 0-4.1.6-5.8 1.8l-113.8 76.6c-9.2 6.2-14.7 16.4-14.7 27.5.1 11 5.5 21.3 14.7 27.4zM387 348.8h-45.5c-5.7 0-10.4 4.7-10.4 10.4v153.3c0 5.7 4.7 10.4 10.4 10.4H387c5.7 0 10.4-4.7 10.4-10.4V359.2c0-5.7-4.7-10.4-10.4-10.4zm333.8 241.3-41-20a10.3 10.3 0 0 0-8.1-.5c-2.6.9-4.8 2.9-5.9 5.4-30.1 64.9-93.1 109.1-164.4 115.2-5.7.5-9.9 5.5-9.5 11.2l3.9 45.5c.5 5.3 5 9.5 10.3 9.5h.9c94.8-8 178.5-66.5 218.6-152.7 2.4-5 .3-11.2-4.8-13.6zm186-186.1c-11.9-42-30.5-81.4-55.2-117.1-24.1-34.9-53.5-65.6-87.5-91.2-33.9-25.6-71.5-45.5-111.6-59.2-41.2-14-84.1-21.1-127.8-21.1h-1.2c-75.4 0-148.8 21.4-212.5 61.7-63.7 40.3-114.3 97.6-146.5 165.8-32.2 68.1-44.3 143.6-35.1 218.4 9.3 74.8 39.4 145 87.3 203.3.1.2.3.3.4.5l36.2 38.4c1.1 1.2 2.5 2.1 3.9 2.6 73.3 66.7 168.2 103.5 267.5 103.5 73.3 0 145.2-20.3 207.7-58.7 37.3-22.9 70.3-51.5 98.1-85 27.1-32.7 48.7-69.5 64.2-109.1 15.5-39.7 24.4-81.3 26.6-123.8 2.4-43.6-2.5-87-14.5-129zm-60.5 181.1c-8.3 37-22.8 72-43 104-19.7 31.1-44.3 58.6-73.1 81.7-28.8 23.1-61 41-95.7 53.4-35.6 12.7-72.9 19.1-110.9 19.1-82.6 0-161.7-30.6-222.8-86.2l-34.1-35.8c-23.9-29.3-42.4-62.2-55.1-97.7-12.4-34.7-18.8-71-19.2-107.9-.4-36.9 5.4-73.3 17.1-108.2 12-35.8 30-69.2 53.4-99.1 31.7-40.4 71.1-72 117.2-94.1 44.5-21.3 94-32.6 143.4-32.6 49.3 0 97 10.8 141.8 32 34.3 16.3 65.3 38.1 92 64.8 26.1 26 47.5 56 63.6 89.2 16.2 33.2 26.6 68.5 31 105.1 4.6 37.5 2.7 75.3-5.6 112.3z" fill="currentColor"></path></svg></button><button type="button" class="wl-action" title="è¡¨æƒ…åŒ…"><svg width="24" height="24" fill="currentcolor" viewBox="0 0 24 24"><path style="transform: translateY(0.5px)" d="M18.968 10.5H15.968V11.484H17.984V12.984H15.968V15H14.468V9H18.968V10.5V10.5ZM8.984 9C9.26533 9 9.49967 9.09367 9.687 9.281C9.87433 9.46833 9.968 9.70267 9.968 9.984V10.5H6.499V13.5H8.468V12H9.968V14.016C9.968 14.2973 9.87433 14.5317 9.687 14.719C9.49967 14.9063 9.26533 15 8.984 15H5.984C5.70267 15 5.46833 14.9063 5.281 14.719C5.09367 14.5317 5 14.2973 5 14.016V9.985C5 9.70367 5.09367 9.46933 5.281 9.282C5.46833 9.09467 5.70267 9.001 5.984 9.001H8.984V9ZM11.468 9H12.968V15H11.468V9V9Z"></path><path d="M18.5 3H5.75C3.6875 3 2 4.6875 2 6.75V18C2 20.0625 3.6875 21.75 5.75 21.75H18.5C20.5625 21.75 22.25 20.0625 22.25 18V6.75C22.25 4.6875 20.5625 3 18.5 3ZM20.75 18C20.75 19.2375 19.7375 20.25 18.5 20.25H5.75C4.5125 20.25 3.5 19.2375 3.5 18V6.75C3.5 5.5125 4.5125 4.5 5.75 4.5H18.5C19.7375 4.5 20.75 5.5125 20.75 6.75V18Z"></path></svg></button><input id="wl-image-upload" class="upload" type="file" accept=".png,.jpg,.jpeg,.webp,.bmp,.gif"><label for="wl-image-upload" class="wl-action" title="ä¸Šä¼ å›¾ç‰‡"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M784 112H240c-88 0-160 72-160 160v480c0 88 72 160 160 160h544c88 0 160-72 160-160V272c0-88-72-160-160-160zm96 640c0 52.8-43.2 96-96 96H240c-52.8 0-96-43.2-96-96V272c0-52.8 43.2-96 96-96h544c52.8 0 96 43.2 96 96v480z" fill="currentColor"></path><path d="M352 480c52.8 0 96-43.2 96-96s-43.2-96-96-96-96 43.2-96 96 43.2 96 96 96zm0-128c17.6 0 32 14.4 32 32s-14.4 32-32 32-32-14.4-32-32 14.4-32 32-32zm462.4 379.2-3.2-3.2-177.6-177.6c-25.6-25.6-65.6-25.6-91.2 0l-80 80-36.8-36.8c-25.6-25.6-65.6-25.6-91.2 0L200 728c-4.8 6.4-8 14.4-8 24 0 17.6 14.4 32 32 32 9.6 0 16-3.2 22.4-9.6L380.8 640l134.4 134.4c6.4 6.4 14.4 9.6 24 9.6 17.6 0 32-14.4 32-32 0-9.6-4.8-17.6-9.6-24l-52.8-52.8 80-80L769.6 776c6.4 4.8 12.8 8 20.8 8 17.6 0 32-14.4 32-32 0-8-3.2-16-8-20.8z" fill="currentColor"></path></svg></label><button type="button" class="wl-action" title="é¢„è§ˆ"><svg viewBox="0 0 1024 1024" width="24" height="24"><path d="M710.816 654.301c70.323-96.639 61.084-230.578-23.705-314.843-46.098-46.098-107.183-71.109-172.28-71.109-65.008 0-126.092 25.444-172.28 71.109-45.227 46.098-70.756 107.183-70.756 172.106 0 64.923 25.444 126.007 71.194 172.106 46.099 46.098 107.184 71.109 172.28 71.109 51.414 0 100.648-16.212 142.824-47.404l126.53 126.006c7.058 7.06 16.297 10.979 26.406 10.979 10.105 0 19.343-3.919 26.402-10.979 14.467-14.467 14.467-38.172 0-52.723L710.816 654.301zm-315.107-23.265c-65.88-65.88-65.88-172.54 0-238.42 32.069-32.07 74.245-49.149 119.471-49.149 45.227 0 87.407 17.603 119.472 49.149 65.88 65.879 65.88 172.539 0 238.42-63.612 63.178-175.242 63.178-238.943 0zm0 0" fill="currentColor"></path><path d="M703.319 121.603H321.03c-109.8 0-199.469 89.146-199.469 199.38v382.034c0 109.796 89.236 199.38 199.469 199.38h207.397c20.653 0 37.384-16.645 37.384-37.299 0-20.649-16.731-37.296-37.384-37.296H321.03c-68.582 0-124.352-55.77-124.352-124.267V321.421c0-68.496 55.77-124.267 124.352-124.267h382.289c68.582 0 124.352 55.771 124.352 124.267V524.72c0 20.654 16.736 37.299 37.385 37.299 20.654 0 37.384-16.645 37.384-37.299V320.549c-.085-109.8-89.321-198.946-199.121-198.946zm0 0" fill="currentColor"></path></svg></button></div><div class="wl-info"><div class="wl-captcha-container"></div><div class="wl-text-number">0 <!--v-if--> Â å­—</div><button type="button" class="wl-btn">ç™»å½•</button><button type="submit" class="primary wl-btn" title="Cmd|Ctrl + Enter"><!--[-->æäº¤<!--]--></button></div><div class="wl-gif-popup"><input type="text" placeholder="æœç´¢è¡¨æƒ…åŒ…"><!--v-if--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div></div><div class="wl-emoji-popup"><!--[--><!--]--><!--v-if--></div></div></div><!--v-if--></div><div class="wl-meta-head"><div class="wl-count"><!--v-if--> è¯„è®º</div><ul class="wl-sort"><!--[--><li class="active">æŒ‰æ­£åº</li><li class="">æŒ‰å€’åº</li><li class="">æŒ‰çƒ­åº¦</li><!--]--></ul></div><div class="wl-cards"><!--[--><!--]--></div><!--[--><div class="wl-loading"><svg width="30" height="30" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid"><circle cx="50" cy="50" fill="none" stroke="currentColor" strokeWidth="4" r="40" stroke-dasharray="85 30"><animateTransform attributeName="transform" type="rotate" repeatCount="indefinite" dur="1s" values="0 50 50;360 50 50" keyTimes="0;1"></animateTransform></circle></svg></div><!--]--><!--v-if--></div></div><!----><!--]--></main><!--]--><!----></div><!--]--><!--]--><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-3e6d2d9d.js" defer></script>
  </body>
</html>
